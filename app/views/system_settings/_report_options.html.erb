<%;################################################
## This file and all its content belong to Faveod S.A.S unless a commercial
## contract signed by a representant of Faveod S.A.S states otherwise.
##########
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
# LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
# OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
# WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
################################################
## This has been generated by Faveod Generator on Tue Oct 27 13:41:19 +0100 2009
## It should be placed at 'app/views/system_settings/_report_options.html.erb'
## All manual modifications will be destroyed on next generation
################################################ 
-%>
<div id ="report_options" class='top_right_menu'>
 <div id='report_options_button' class='hidden_box_button expanded'
   onclick="Effect.toggle('report_options_box', 'blind', {duration: 0.5});$('report_options_button').toggleClassName('expanded');">
   <%= _(%q{Report options}) %></div>
 <div id='report_options_box' class='hidden_box reports'><div>
   <button id='save_image'  onclick="save_image()" style='width:15em'>
     <img alt="Page_white_camera" src="/images/page_icons/page_white_camera.png?1250265829" /> <%= _(%q{Extract image}) %><br /><%= _(%q{(to print or save)}) %></button>
   <button id='save_report' onclick="save_report({url: '<%= params[:report]%>'})" style='width:15em'>
     <img alt="Server_chart" src="/images/page_icons/server_chart.png?1250265829" /> <%= _(%q{Save report}) %><br /><%= _(%q{(for archive or comparison)}) %></button>

 <fieldset id='presets_fs'><legend><%= _(%q{Choose preset}) %></legend>
 <div id='presets_div' class='collapsible'>
  <table></table>
 </div></fieldset>


  <fieldset id='saved_reports_fs' style='clear:both'><legend><%= _(%q{Saved Reports}) %></legend>
   <div id='saved_reports_div' class='collapsible'>
    <div id="saved_reports"><%= content_tag(:ul,
      SavedReport.all.map{|sr| content_tag(:li,
        link_to(image_tag("/images/page_icons/chart_curve.png") + ' ' + sr.disp_name,
          '#', {:onclick => %Q[load_saved_report("#{sr.url}")]}))}.join,
        :class => 'light', :id => 'saved_reports_list') %></div>
  </div></fieldset>


  <fieldset id='smart_queries_fs' style='clear:both'><legend><%= _(%q{Data Sets}) %></legend>
   <div id='smart_queries_div' class='collapsible'>
    <div id="smart_queries"><%= content_tag(:ul,
      SmartQuery.for_table('system_settings').map{|sq| content_tag(:li,
        link_to(image_tag("/images/page_icons/table_lightning.png") + ' ' + sq.name,
          '#', {:onclick => "select_data_set(#{sq.id})"}))}.join,
          :class => 'light') %></div>
  </div></fieldset>


 <fieldset id='chart_options_fs'><legend><%= _(%q{Options}) %></legend>
 <form method="post" id="options_form" action="/system_settings/reporting">
 <div id='chart_options_div' class='collapsible'>
  <label><%= _(%q{Title}) %>: <input type='text' id='options_title' name='title'></label>
  <label><%= _(%q{Background color}) %>: <input type='text' id='options_bg_color' name='background' class="color_picker_input" size='8'></label>
 </div></form></fieldset>
</div></div></div>


<script type="text/javascript">
//<![CDATA[


function edit_report() {

var js = JSON.parse(Reports['resp1'])
var new_title = $('options_title') ? $F('options_title') : ''
var new_bgcolor = $('options_bg_color') ? $F('options_bg_color') : ''
var new_titlecolor = $('options_title_color') ? $F('options_title_color') : ''

if (new_title != '') js.title.text = new_title;
if (new_bgcolor != '') js.bg_colour = new_bgcolor;
if (new_titlecolor != '') { js.title.style = js.title.style.gsub(/(colou?r:.{,25})[;,}]/, 'color:#'+ new_titlecolor) }

var new_json = $H(js).toJSON()
Reports['resp1'] = new_json
$('div_chart_1').load(new_json)

}

function save_image() {

 var codes = $$('object[id^=div_chart]').map(function(o) {
  return '<img src="data:image/png;base64,' + o.get_img_binary() + '" />'
 })

 var img_win = window.open('', 'Charts: Export as Image')
 with(img_win.document) {
   write("<html><head><title>Charts: Export as Image</title></head><body>" +
	codes.join("<br /><br />") + "</body></html>")
 }

}

function select_data_set(id) {

}

function save_report(report) {

var js = JSON.parse(Reports['resp1'])
var mytitle = (js && js.title) ? js.title.text : ''
new Ajax.Request("/saved_reports/add_report", {method: 'post',
  postBody: $H({name: mytitle, url: Reports['url1'], data: Reports['resp1'] }).toQueryString()})
}

function ofc_data() {
Reports["resp1"]
}

function load_saved_report(url) {

$('options_bg_color').setStyle({backgroundColor: 'white'});
$('options_bg_color').value = '';
$('options_title').value = '';
Reports['url1'] = url; update_reports()
}

function onload_report_options_call() {
alignValues('chart_options_fs')
add_collapsible_behaviour()
new Form.Observer('options_form', 0.5, edit_report)
if ($("options_title_color")) {new Control.ColorPicker("options_title_color")}
if ($("options_bg_color")) {new Control.ColorPicker("options_bg_color")}

}
<% if request.xhr? %>onload_report_options_call();<% else %>Event.observe(window, 'load', onload_report_options_call);<% end %>
//]]>
</script>