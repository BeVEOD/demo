<%;################################################
## This file and all its content belong to Faveod S.A.S unless a commercial
## contract signed by a representant of Faveod S.A.S states otherwise.
##########
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
# LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
# OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
# WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
################################################
## This has been generated by Faveod Generator on Thu Sep 24 17:28:13 +0200 2009
## It should be placed at 'app/views/app_locales/report_chooser.html.erb'
## All manual modifications will be destroyed on next generation
################################################ 
-%>
<script type="text/javascript" src="/javascripts/swfobject/swfobject.js"></script>
<h2 class="title"><%= _(%q{Report Chooser}) %> </h2>
<script type="text/javascript"> 
//<![CDATA[

function add_reports() {
  i = 1;
  while(Reports["url"+i]) {
    if (Reports["url"+i].match(/report_generate\.json/)) {
      swfobject.embedSWF("/open-flash-chart.swf", "div_chart_" + i, "600", "400", "9.0.0", "expressInstall.swf", {"get-data":"get_data", "id":i});
    } else {
      if (typeof($("div_chart_" + i)) == 'function') {
        $("div_chart_" + i).replace('<div id="div_chart_' + i + '"></div>')
      }
      $("div_chart_" + i).update('Loading data...')
      new Ajax.Updater("div_chart_" + i, Reports["url"+i], {method:'get'})
    }
  ++i;
 }
}

function get_data(i) {
  var url = Reports["url"+i]
  if ($('data_set').value != "") { url += "&data_set=" + $('data_set').value}
  new Ajax.Request(url, {method: 'get', asynchronous: false, onSuccess: function(resp) {
    Reports["resp"+i] = $H(resp.responseJSON).toJSON()
//    console.log("resp " + i + ": " + Reports["resp"+i])
  }});
  return Reports["resp"+i]
}

var Reports = {}

function set_report(url) {
  Reports['url1'] = url
  add_reports()
}

//]]>
</script>




<br style="clear:both"/><hr />
<fieldset id="report_options" style="float:right;width:30%"><legend><%= _(%q{Report Options}) %></legend>
<label><%= _(%q{Data Sets: }) %>
<%= select_tag('data_set',
		options_for_select(@data_sets.map{|s| [s.name, s.id]}, @data_set.id),
		:onchange => %q[set_report(Reports.url1 + '&data_set=' + this.value)]) %></label>
<a href="#" onclick="var newdataset_window_win = new Window('newdataset_window', {center:true, destroyOnClose:true, height:400, title:'New Data Set', width:700, windowParameters:{}, zIndex:1100});
newdataset_window_win.showCenter();
newdataset_window_win.setAjaxContent('<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/new?filters[table_name]=app_locales', {})"><%= _(%q{New Data Set}) %></a>
</fieldset>
<div id="div_chart"></div>

<div id="div_chart_1"></div>
<div id="div_chart_2"></div><br /><br />
