<%;################################################
## This file and all its content belong to Faveod S.A.S unless a commercial
## contract signed by a representant of Faveod S.A.S states otherwise.
##########
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
# LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
# OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
# WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
################################################
## This has been generated by Faveod Generator on Sat Aug 22 19:24:35 +0200 2009
## It should be placed at 'app/views/profiles/_importer_data_source.html.erb'
## All manual modifications will be destroyed on next generation
################################################ 
-%>
<p class="help" id='profiles_indicator'>Your database currently holds
  <%= link_to (_('%{n} Profiles') % {:n => Profile.count},
    :controller => 'profiles', :action => 'list') %>
</p>

<fieldset><legend>Data Source</legend>
<%= content_tag(:div, @msg[:data_source], :class => 'notice') if @msg[:data_source] %>

<p class="help">Choose a file or upload a new one (<%= @valid_exts.join(', ') %>)</p>

<div id="file_selector" class="float">
<%= file_sel = [['-', '']] + @files.map{|f| info = f.split('-')
  date = info[1]; hour = info[2]; name = info [3..-1]
  size = number_to_human_size(File.stat(File.join(@fpath, f)).size)
  moment = Date.today.to_s.gsub('-', '') == date ?
    (_('at') + " #{hour[0..1]}h#{hour[2..3]}m#{hour[4..5]}s") :
    (_('on') + " #{date[0..3]}-#{date[4..5]}-#{date[6..7]}" )
    ["#{name} (#{size}, #{moment})", f]}

select_tag ("file[select]",
  options_for_select(file_sel, @file),
    {:id => "file_select", :class => "source_options"}) %>

  <%= link_to_remote(image_tag('page_icons/page_white_put.png'),
    { :url     => "/profiles/importer", 
      :with    => "'commit=download&file[select]=' + $F('file_select')",
      :method  => :post}) if @file %>

  <%= link_to_remote(image_tag('std/del.png'),
    { :url     => "/profiles/importer", 
      :with    => "'commit=delete&file[select]=' + $F('file_select')",
      :method  => :post,
      :confirm => _("Are you sure that you want to remove this file?")}) if @file %>
</div>

<label class="float">File Encoding: <%= select_tag("options[enc]", options_for_select(@encodings, @encoding), :class => "source_options") %></label>


<div id="file_uploader" class='float'>
  <label>Upload: <input type="file" name="file[upload]" id="file_upload"/>
  <%= submit_tag('upload', :name => "upload", :id => 'upload') %></label>
</div>


<p class="help">Importer options</p>
<% if @sources %>
<label class="float">Data source: <%= select_tag("options[source]", options_for_select(@sources, @source), :class => "source_options") %></label>
<% else %>
<label class="float">CSV separator: <%= select_tag("options[sep]", options_for_select(@separators, params[:options][:sep]  || ''), :class => "source_options") %></label>
<% end %>

<label class="float">
  <%= check_box_tag("options[no_rollback]", '1', params[:options][:no_rollback], :class => "import_options") %>
  don't cancel import if an error is found</label>
<label class="float">
  <%= check_box_tag("options[no_headers]", '1', params[:options][:no_headers], :class => "source_options") %>
  don't skip first line</label>

<p class="help">Filter the data from your file</p>

<label class="float">Import: <%= text_field_tag("options[limit]",   params[:options][:limit]   || @max, 		:size => 7, :class => "import_options") %>
<%= hidden_field_tag("options[max]", @max) %> / <%= @max %></label>
<label class="float">Preview: <%= text_field_tag("options[preview]", params[:options][:preview] || 25, 		:size => 7, :class => "source_options") %></label>
<label class="float">Start at: <%= text_field_tag("options[offset]",  params[:options][:offset]  || 0, 		:size => 7, :class => "source_options") %></label>
<br /><br style="clear: both;"/>

</fieldset>



<script type="text/javascript">
//<![CDATA[


function onload_importer_data_source_call() {
setup_importer_observers('.source_options')
}
<% if request.xhr? %>onload_importer_data_source_call();<% else %>Event.observe(window, 'load', onload_importer_data_source_call);<% end %>
//]]>
</script>