<%;################################################
## This file and all its content belong to Faveod S.A.S unless a commercial
## contract signed by a representant of Faveod S.A.S states otherwise.
##########
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
# LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
# OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
# WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
################################################
## This has been generated by Faveod Generator on Thu Apr 04 01:37:27 +0200 2013
## It should be placed at 'app/views/accesses/permissions_old.html.erb'
## All manual modifications will be destroyed on next generation
################################################ 
%><h2 class="title"><%= _("Permissions of %{page}") % {:page => _(@page.table_sid.titleize)} %> </h2>

<script type="text/javascript">
//<![CDATA[

function setEffective(access) {
  if ($("profile_access_"+access).checked || $("user_access_"+access).checked) {
    $("effec_"+access).src = '/images/std/green.gif'
  } else {
    $("effec_"+access).src = '/images/std/red.gif'
  }
}
function setAllProfileAccesses(set) {
  $$('#permissions_table TD INPUT.profile_box').each(function(n) {
    if (set != n.checked) { n.click() }
  })
}
function setAllUserAccesses(set) {
  $$('#permissions_table TD INPUT.user_box').each(function(n) {
    if (set != n.checked) { n.click() }
  })
}
function setFieldEffective(access) {
  if ($("profile_access_"+access+"_read").checked || $("profile_access_"+access+"_write").checked || $("user_access_"+access+"_read").checked || $("user_access_"+access+"_write").checked) {
    $("effec_"+access).src = '/images/std/green.gif'
  } else {
    $("effec_"+access).src = '/images/std/red.gif'
  }
}
function setAllProfileFieldAccesses(set) {
  $$('#permissions_table TD INPUT.profile_field_box').each(function(n) {
    if (set != n.checked) { n.click() }
  })
}
function setAllUserFieldAccesses(set) {
  $$('#permissions_table TD INPUT.user_field_box').each(function(n) {
    if (set != n.checked) { n.click() }
  })
}

//]]>
</script>

<label><%= _("Page: ") %><%= select_tag('page_id',
		option_groups_from_hash_for_select(@ps_for_col, :last, :first, @page.id),
#		options_for_select(@pages.map{|p| [_(p.table_sid.titleize), p.id]}, @page.id),
		:onchange => remote_function(:update => 'content', :url => {:action => :permissions},
			:with => %q{'user_id='+$('user_id').value+'&profile_id='+$('profile_id').value+'&page_id='+value})) %></label>
<table style="text-align:center" id="permissions_table">
<thead>
<tr><th rowspan="2" style="font-size:larger;font-weight:bold"><%= _("Actions") %><br />
  </th>
<th><%= _("Profile") %><br /><a href="#" onclick="setAllProfileAccesses(true);; return false;"><%= _(%q{Select [All]}) %></a> / <a href="#" onclick="setAllProfileAccesses(false);; return false;"><%= _(%q{Select [None]}) %></a></th>
<th><%= _("User") %><br /><a href="#" onclick="setAllUserAccesses(true);; return false;"><%= _(%q{Select [All]}) %></a> / <a href="#" onclick="setAllUserAccesses(false);; return false;"><%= _(%q{Select [None]}) %></a></th>
<th rowspan="2"><%= _('Effective') %></th></tr>

<tr>
<th><%= select_tag('profile_id', options_for_select(@profiles.map{|p| [p.name, p.id]}, @profile.id),
		:onchange => remote_function(:update => 'content', :url => {:action => :permissions},
			:with => %q{'profile_id='+value+'&page_id='+$('page_id').value})) %>
<% if @pres_mode == :list_zoom %><a href="#" onclick="new Ajax.Updater('profiles_element', '<%= "/#{params[:lang]}" if params[:lang] %>/profiles/access_graph/<%= @profile.id %>', {asynchronous:true, evalScripts:true}); return false;" title="<%= _(%q{Rights management: display graph.}) %>"><img src="/images/page_icons/chart_organisation.png" alt="<%= _(%q{Access Graph}) %>" title="<%= _(%q{Access Graph}) %>" /></a><% else %><a href="<%= "/#{params[:lang]}" if params[:lang] %>/profiles/access_graph/<%= @profile.id %>" title="<%= _(%q{Rights management: display graph.}) %>"><img src="/images/page_icons/chart_organisation.png" alt="<%= _(%q{Access Graph}) %>" title="<%= _(%q{Access Graph}) %>" /></a><% end %>
</th>
<th><%= @user ? select_tag('user_id', options_for_select(@users.map{|p| [p.disp_name, p.id]}, @user.id),
		:onchange => remote_function(:update => 'content', :url => {:action => :permissions},
			:with => %q{'user_id='+value+'&profile_id='+$('profile_id').value+'&page_id='+$('page_id').value})) : hidden_field_tag('user_id') %>
<% if @user %><% if @pres_mode == :list_zoom %><a href="#" onclick="new Ajax.Updater('users_element', '<%= "/#{params[:lang]}" if params[:lang] %>/users/access_graph/<%= @user.id %>', {asynchronous:true, evalScripts:true}); return false;" title="<%= _(%q{Rights management: access graph.}) %>"><img src="/images/page_icons/chart_organisation.png" alt="<%= _(%q{Access Graph}) %>" title="<%= _(%q{Access Graph}) %>" /></a><% else %><a href="<%= "/#{params[:lang]}" if params[:lang] %>/users/access_graph/<%= @user.id %>" title="<%= _(%q{Rights management: access graph.}) %>"><img src="/images/page_icons/chart_organisation.png" alt="<%= _(%q{Access Graph}) %>" title="<%= _(%q{Access Graph}) %>" /></a><% end %><% end %>
</th>
</tr></thead>

<% @aktions.each do |a| %><tr>
<td><%=h a.action_sid %></td>
<td><%= check_box_tag("aktion_#{a.id}_profile_#{@profile.id}", '1',
		@profile.accesses.first(:conditions => {'accesses.id' => a.id}),
		:class => "profile_box", :id => "profile_access_#{a.id}",
		:onclick => "setEffective(#{a.id});"+remote_function(:url => {:action => :set_permission},
			:with => %{'set='+this.checked+'&access_id=#{a.id}&profile_id='+$('profile_id').value})) %></td>
<td><%= @user ? check_box_tag("aktion_#{a.id}_user_#{@user.id}", '1',
		@user.accesses.first(:conditions => {'accesses.id' => a.id}),
		:class => "user_box", :id => "user_access_#{a.id}",
		:onclick => "setEffective(#{a.id});"+remote_function(:url => {:action => :set_permission},
			:with => %{'set='+this.checked+'&access_id=#{a.id}&user_id='+$('user_id').value+'&page_id='+$('page_id').value})) : hidden_field_tag("user_access_#{a.id}") %></td>
<td><%= (@profile.accesses.first(:conditions => {'accesses.id' => a.id}) || (@user && @user.accesses.first(:conditions => {'accesses.id' => a.id}))) ? image_tag("std/green.gif", :id => "effec_#{a.id}") : image_tag("std/red.gif", :id => "effec_#{a.id}") %></td>
</tr><% end %>
</table>

<% if @fields.any? %>

<table style="text-align:center" id="field_permissions_table">
<thead>
<tr><th rowspan="2" style="font-size:larger;font-weight:bold"><%= _("Fields") %><br /></th>
<th><a href="#" onclick="setAllProfileFieldAccesses(true);; return false;"><%= _(%q{Select [All]}) %></a> / <a href="#" onclick="setAllProfileFieldAccesses(false);; return false;"><%= _(%q{Select [None]}) %></a></th>
<th><a href="#" onclick="setAllUserFieldAccesses(true);; return false;"><%= _(%q{Select [All]}) %></a> / <a href="#" onclick="setAllUserFieldAccesses(false);; return false;"><%= _(%q{Select [None]}) %></a></th>
<th rowspan="2"><%= _('Effective') %></th></tr>

<tr style="background-color:#CCC;">
<th style="text-align:center"><% if @pres_mode == :list_zoom %><a href="#" onclick="new Ajax.Updater('profiles_element', '<%= "/#{params[:lang]}" if params[:lang] %>/profiles/field_access_graph/<%= @profile.id %>', {asynchronous:true, evalScripts:true}); return false;" style="float:right" title="<%= _(%q{Rights management: graph per fields.}) %>"><img src="/images/page_icons/chart_organisation.png" alt="<%= _(%q{Field Access Graph}) %>" title="<%= _(%q{Field Access Graph}) %>" /></a><% else %><a href="<%= "/#{params[:lang]}" if params[:lang] %>/profiles/field_access_graph/<%= @profile.id %>" style="float:right" title="<%= _(%q{Rights management: graph per fields.}) %>"><img src="/images/page_icons/chart_organisation.png" alt="<%= _(%q{Field Access Graph}) %>" title="<%= _(%q{Field Access Graph}) %>" /></a><% end %>
<span><%= _("Read | Write") %></span></th>
<th style="text-align:center"><% if @user %><% if @pres_mode == :list_zoom %><a href="#" onclick="new Ajax.Updater('users_element', '<%= "/#{params[:lang]}" if params[:lang] %>/users/field_access_graph/<%= @user.id %>', {asynchronous:true, evalScripts:true}); return false;" style="float:right" title="<%= _(%q{Rights management: access graph.}) %>"><img src="/images/page_icons/chart_organisation.png" alt="<%= _(%q{Field Access Graph}) %>" title="<%= _(%q{Field Access Graph}) %>" /></a><% else %><a href="<%= "/#{params[:lang]}" if params[:lang] %>/users/field_access_graph/<%= @user.id %>" style="float:right" title="<%= _(%q{Rights management: access graph.}) %>"><img src="/images/page_icons/chart_organisation.png" alt="<%= _(%q{Field Access Graph}) %>" title="<%= _(%q{Field Access Graph}) %>" /></a><% end %>
<span><%= _("Read | Write") %></span><% end %></th>
</tr>
</thead>

<% @fields.each do |f| %><tr>
<td><%=h f.field_sid %></td>
<td><%= check_box_tag("field_#{f.id}_profile_#{@profile.id}[read]", '1',
		!@profile.profile_accesses.first(:conditions => ["access_id = ? AND `read` = ?", f.id, true]).nil?,
		:class => "profile_field_box", :id => "profile_access_#{f.id}_read",
		:onclick => "setFieldEffective(#{f.id});"+remote_function(:url => {:action => :set_permission},
			:with => %{'set='+this.checked+'&access_id=#{f.id}&profile_id='+$('profile_id').value+'∝=read'})) %> | 
<%= check_box_tag("field_#{f.id}_profile_#{@profile.id}[write]", '1',
		!@profile.profile_accesses.first(:conditions => ["access_id = ? AND `write` = ?", f.id, true]).nil?,
		:class => "profile_field_box", :id => "profile_access_#{f.id}_write",
		:onclick => "setFieldEffective(#{f.id});"+remote_function(:url => {:action => :set_permission},
			:with => %{'set='+this.checked+'&access_id=#{f.id}&profile_id='+$('profile_id').value+'∝=write'})) %>
			</td>
<td><%= check_box_tag("aktion_#{f.id}_user_#{@user.id}[read]", '1',
		!@user.user_accesses.first(:conditions => ["access_id = ? AND `read` = ?", f.id, true]).nil?,
		:class => "user_field_box", :id => "user_access_#{f.id}_read",
		:onclick => "setFieldEffective(#{f.id});"+remote_function(:url => {:action => :set_permission},
			:with => %{'set='+this.checked+'&access_id=#{f.id}&user_id='+$('user_id').value+'&page_id='+$('page_id').value+'∝=read'})) + ' | ' + check_box_tag("aktion_#{f.id}_user_#{@user.id}[write]", '1',
		!@user.user_accesses.first(:conditions => ["access_id = ? AND `write` = ?", f.id, true]).nil?,
		:class => "user_field_box", :id => "user_access_#{f.id}_write",
		:onclick => "setFieldEffective(#{f.id});"+remote_function(:url => {:action => :set_permission},
			:with => %{'set='+this.checked+'&access_id=#{f.id}&user_id='+$('user_id').value+'&page_id='+$('page_id').value+'∝=write'})) if @user %></td>
<td><%= (!@profile.profile_accesses.first(:conditions => ["access_id = ? AND (`read` = ? OR `write` = ?)", f.id, true, true]).nil? || (@user && !@user.user_accesses.first(:conditions => ["access_id = ? AND (`write` = ? OR `read` = ?)", f.id, true, true]).nil?)) ? image_tag("std/green.gif", :id => "effec_#{f.id}") : image_tag("std/red.gif", :id => "effec_#{f.id}") %></td>
</tr><% end %>
</table>


<script type="text/javascript">
//<![CDATA[
$("field_permissions_table").down('TH').width = $('permissions_table').down('TH').getWidth()
//]]>
</script>
<% end %>
