<%;################################################
## This file and all its content belong to Faveod S.A.S unless a commercial
## contract signed by a representant of Faveod S.A.S states otherwise.
##########
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
# LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
# OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
# WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
################################################
## This has been generated by Faveod Generator on Thu Oct 31 16:38:12 +0100 2013
## It should be placed at 'app/views/smart_queries/edit.html.erb'
## All manual modifications will be destroyed on next generation
################################################ %>
<h2 class="title"><img src="/images/page_icons/page_white_paintbrush.png" alt="<%= _(%q{Edit}) %>" /> <%= _("Editing %{model} %{record}") % {:model => _("Smart Query"), :record => @smart_query.disp_name} %> </h2>
<% unless(request.xhr? || @no_menubar) %>
<div class="menubar"><ul id="main-menubar"><li class="file_menu first"><a href="#"><%= _(%q{File}) %></a><ul><li><% if @pres_mode == :list_zoom %>
<a href="#" data-method="get" onclick="new Ajax.Updater('smart_queries_element', '<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/new', {asynchronous:true, evalScripts:true}); return false;" rel="nofollow" title="<%= _(%q{Adding a saved report.}) %>"><img src="/images/page_icons/add.png" alt="<%= _(%q{New}) %>" title="<%= _(%q{New}) %>" /> <%= _(%q{New}) %></a>
<% else %>
<a href="<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/new" data-method="get" rel="nofollow" title="<%= _(%q{Adding a saved report.}) %>"><img src="/images/page_icons/add.png" alt="<%= _(%q{New}) %>" title="<%= _(%q{New}) %>" /> <%= _(%q{New}) %></a>
<% end %></li><li class="sep"></li><li><a href="#"><%= _("Download as") %></a><ul><li><% if @pres_mode == :list_zoom %>
<a href="#" data-method="get" onclick="new Ajax.Updater('smart_queries_element', '<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/download/<%= @smart_query.id %>.html', {asynchronous:true, evalScripts:true}); return false;" rel="nofollow" title="<%= _(%q{Allows download of all or current record in many formats.}) %>"><img src="/images/file_icons/html.png" alt="<%= _(%q{Download}) %>" title="<%= _(%q{Download}) %>"/> <%= _(%q{HTML}) %></a>
<% else %>
<a href="<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/download/<%= @smart_query.id %>.html" data-method="get" rel="nofollow" title="<%= _(%q{Allows download of all or current record in many formats.}) %>"><img src="/images/file_icons/html.png" alt="<%= _(%q{Download}) %>" title="<%= _(%q{Download}) %>"/> <%= _(%q{HTML}) %></a>
<% end %></li><li><% if @pres_mode == :list_zoom %>
<a href="#" data-method="get" onclick="new Ajax.Updater('smart_queries_element', '<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/download/<%= @smart_query.id %>.csv', {asynchronous:true, evalScripts:true}); return false;" rel="nofollow" title="<%= _(%q{Allows download of all or current record in many formats.}) %>"><img src="/images/file_icons/defaut.png" alt="<%= _(%q{Download}) %>" title="<%= _(%q{Download}) %>"/> <%= _(%q{CSV}) %></a>
<% else %>
<a href="<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/download/<%= @smart_query.id %>.csv" data-method="get" rel="nofollow" title="<%= _(%q{Allows download of all or current record in many formats.}) %>"><img src="/images/file_icons/defaut.png" alt="<%= _(%q{Download}) %>" title="<%= _(%q{Download}) %>"/> <%= _(%q{CSV}) %></a>
<% end %></li><li><% if @pres_mode == :list_zoom %>
<a href="#" data-method="get" onclick="new Ajax.Updater('smart_queries_element', '<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/download/<%= @smart_query.id %>.xls', {asynchronous:true, evalScripts:true}); return false;" rel="nofollow" title="<%= _(%q{Allows download of all or current record in many formats.}) %>"><img src="/images/file_icons/xls.png" alt="<%= _(%q{Download}) %>" title="<%= _(%q{Download}) %>"/> <%= _(%q{XLS}) %></a>
<% else %>
<a href="<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/download/<%= @smart_query.id %>.xls" data-method="get" rel="nofollow" title="<%= _(%q{Allows download of all or current record in many formats.}) %>"><img src="/images/file_icons/xls.png" alt="<%= _(%q{Download}) %>" title="<%= _(%q{Download}) %>"/> <%= _(%q{XLS}) %></a>
<% end %></li><li><% if @pres_mode == :list_zoom %>
<a href="#" data-method="get" onclick="new Ajax.Updater('smart_queries_element', '<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/download/<%= @smart_query.id %>.xml', {asynchronous:true, evalScripts:true}); return false;" rel="nofollow" title="<%= _(%q{Allows download of all or current record in many formats.}) %>"><img src="/images/file_icons/xml.png" alt="<%= _(%q{Download}) %>" title="<%= _(%q{Download}) %>"/> <%= _(%q{XML}) %></a>
<% else %>
<a href="<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/download/<%= @smart_query.id %>.xml" data-method="get" rel="nofollow" title="<%= _(%q{Allows download of all or current record in many formats.}) %>"><img src="/images/file_icons/xml.png" alt="<%= _(%q{Download}) %>" title="<%= _(%q{Download}) %>"/> <%= _(%q{XML}) %></a>
<% end %></li><li><% if @pres_mode == :list_zoom %>
<a href="#" data-method="get" onclick="new Ajax.Updater('smart_queries_element', '<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/download/<%= @smart_query.id %>.pdf', {asynchronous:true, evalScripts:true}); return false;" rel="nofollow" title="<%= _(%q{Allows download of all or current record in many formats.}) %>"><img src="/images/file_icons/pdf.png" alt="<%= _(%q{Download}) %>" title="<%= _(%q{Download}) %>"/> <%= _(%q{PDF}) %></a>
<% else %>
<a href="<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/download/<%= @smart_query.id %>.pdf" data-method="get" rel="nofollow" title="<%= _(%q{Allows download of all or current record in many formats.}) %>"><img src="/images/file_icons/pdf.png" alt="<%= _(%q{Download}) %>" title="<%= _(%q{Download}) %>"/> <%= _(%q{PDF}) %></a>
<% end %></li></ul></li>
<li class="sep"></li><li><a href="#" onclick="Layout.print_element_id('content', '<%= @smart_query && !@smart_query.is_a?(Array) ? @smart_query.disp_name : _('List') %>');; return false;"><%= image_tag("/images/std/print.gif") %><%= _(%q{Print...}) %></a></li><% if @menubar_actions && @menubar_actions[:file].is_a?(Array) %><li class="sep"></li><% @menubar_actions[:file].each do |elt| %>
<%= content_tag(:li, elt) if elt.is_a?(String) %><% end %><% end %></ul></li>
<li><a href="#"><%= _(%q{Edit}) %></a>
<ul><li><% if @pres_mode == :list_zoom %>
<a href="#" onclick="new Ajax.Updater('smart_queries_element', '<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/search', {asynchronous:true, evalScripts:true}); return false;" title="<%= _(%q{Search and filter data.}) %>"><img src="/images/page_icons/magnifier.png" alt="<%= _(%q{Search}) %>" title="<%= _(%q{Search}) %>" /> <%= _(%q{Search}) %></a>
<% else %>
<a href="<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/search" title="<%= _(%q{Search and filter data.}) %>"><img src="/images/page_icons/magnifier.png" alt="<%= _(%q{Search}) %>" title="<%= _(%q{Search}) %>" /> <%= _(%q{Search}) %></a>
<% end %></li><li><% if @pres_mode == :list_zoom %>
<a href="#" onclick="new Ajax.Updater('smart_queries_element', '<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/adv_search', {asynchronous:true, evalScripts:true}); return false;" title="<%= _(%q{Make complex queries.}) %>"><img src="/images/page_icons/magnifier_zoom_in.png" alt="<%= _(%q{Adv Search}) %>" title="<%= _(%q{Adv Search}) %>" /> <%= _(%q{Adv Search}) %></a>
<% else %>
<a href="<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/adv_search" title="<%= _(%q{Make complex queries.}) %>"><img src="/images/page_icons/magnifier_zoom_in.png" alt="<%= _(%q{Adv Search}) %>" title="<%= _(%q{Adv Search}) %>" /> <%= _(%q{Adv Search}) %></a>
<% end %></li><li><% if @pres_mode == :list_zoom %>
<a href="#" onclick="new Ajax.Updater('smart_queries_element', '<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/global_search', {asynchronous:true, evalScripts:true}); return false;"><img src="/images/page_icons/magnifier.png" alt="<%= _(%q{Global Search}) %>" title="<%= _(%q{Global Search}) %>" /> <%= _(%q{Global Search}) %></a>
<% else %>
<a href="<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/global_search"><img src="/images/page_icons/magnifier.png" alt="<%= _(%q{Global Search}) %>" title="<%= _(%q{Global Search}) %>" /> <%= _(%q{Global Search}) %></a>
<% end %></li><% if @menubar_actions && @menubar_actions[:edit].is_a?(Array) %><li class="sep"></li><% @menubar_actions[:edit].each do |elt| %>
<%= content_tag(:li, elt) if elt.is_a?(String) %><% end %><% end %></ul></li>
<li><a href="#"><%= _(%q{Presentation}) %></a>
<ul><% if @menubar_actions && @menubar_actions[:presentation].is_a?(Array) %><li class="sep"></li><% @menubar_actions[:presentation].each do |elt| %>
<%= content_tag(:li, elt) if elt.is_a?(String) %><% end %><% end %></ul></li>
<li><a href="#"><%= _(%q{Browsing}) %></a><ul><li><% if @pres_mode == :list_zoom %>
<a href="#" data-method="get" onclick="new Ajax.Updater('smart_queries_element', '<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/list', {asynchronous:true, evalScripts:true}); return false;" rel="nofollow" title="<%= _(%q{This gives the list of all records}) %>"><img src="/images/page_icons/application_view_list.png" alt="<%= _(%q{List}) %>" title="<%= _(%q{List}) %>" /> <%= _(%q{List}) %></a>
<% else %>
<a href="<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/list" data-method="get" rel="nofollow" title="<%= _(%q{This gives the list of all records}) %>"><img src="/images/page_icons/application_view_list.png" alt="<%= _(%q{List}) %>" title="<%= _(%q{List}) %>" /> <%= _(%q{List}) %></a>
<% end %></li><li><% if @pres_mode == :list_zoom %>
<a href="#" data-method="get" onclick="new Ajax.Updater('smart_queries_element', '<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/help', {asynchronous:true, evalScripts:true}); return false;" rel="nofollow" title="<%= _(%q{Gives help about current module.}) %>"><img src="/images/std/help.png" alt="<%= _(%q{Help}) %>" title="<%= _(%q{Help}) %>"/> <%= _(%q{Help}) %></a>
<% else %>
<a href="<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/help" data-method="get" rel="nofollow" title="<%= _(%q{Gives help about current module.}) %>"><img src="/images/std/help.png" alt="<%= _(%q{Help}) %>" title="<%= _(%q{Help}) %>"/> <%= _(%q{Help}) %></a>
<% end %></li><li class="sep"></li><li><% if @pres_mode == :list_zoom %>
<a href="#" data-method="get" onclick="new Ajax.Updater('smart_queries_element', '<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/show/<%= @smart_query.id %>', {asynchronous:true, evalScripts:true}); return false;" rel="nofollow" title="<%= _(%q{Display the record.}) %>"><img src="/images/std/show.png" alt="<%= _(%q{Show}) %>" title="<%= _(%q{Show}) %>"/> <%= _(%q{Show current}) %></a>
<% else %>
<a href="<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/show/<%= @smart_query.id %>" data-method="get" rel="nofollow" title="<%= _(%q{Display the record.}) %>"><img src="/images/std/show.png" alt="<%= _(%q{Show}) %>" title="<%= _(%q{Show}) %>"/> <%= _(%q{Show current}) %></a>
<% end %></li></ul></li>
</ul><br style="clear:left;" /></div>
<% end %>
<div class="content" id="container">
 <div class="fields align_fields">
<%= error_messages_for 'smart_query' %>
<form action="<%= "/#{params[:lang]}" if params[:lang] %>/smart_queries/update/<%= @smart_query.id %>" id="smart_query_<%= @smart_query.id || 0 %>_form" method="post"><input name="_method" type="hidden" value="put" />
<fieldset style="border:none;" id="smart_query_<%=  @smart_query.id || 0  %>_root_container" >
<label for="smart_query_<%=  @smart_query.id || 0  %>_name" id="smart_queries_name_<%= @smart_query.id || 0 %>"><%= s_(%q{Name: }) %><input id="smart_query_<%= @smart_query.id || 0 %>_name" maxlength="255" name="smart_query[<%=  @smart_query.id || 0  %>][name]" type="text" value="<%=h @smart_query.name %>" /></label>
<label><%= _(%q{Table}) %>:
  <%= select_tag("smart_query[#{@smart_query.id || 0}][table_sid]",
   option_groups_from_hash_for_select(@grouped_tables, :last, :first, @smart_query),
   :id => "smart_query_#{@smart_query.id || 0}_table_sid",
   :class => "table_select" ) %>
</label>
<label for="smart_query_<%=  @smart_query.id || 0  %>_joining_criteria" id="smart_queries_joining_criteria_<%= @smart_query.id || 0 %>"><%= s_(%q{Joining Criteria: }) %><select name="smart_query[<%=  @smart_query.id || 0  %>][joining_criteria]" id="smart_query_<%= @smart_query.id || 0 %>_joining_criteria" >
<%= options_for_select(@smart_query.joining_criteria__potential_values(@current_user).map{|p| [_(p), (SmartQuery::JOINING_CRITERIA.index(p) || -1 )+1] }, @smart_query.joining_criteria__index) %>
</select></label>
<%= render :partial => "field_conditions" %>
<input value="<%= _(%q{Test Query}) %>" type="button" id="test_query" />
<br />
<br />
<div id="query_results"> </div>

</fieldset>

<input data-disable-with="<%= h(_(%q{Saving...})) %>" disable_with="Saving..." id="edit_submit_form_submit" name="commit" type="submit" value="<%= _(%q{Submit}) %>" />
</form>
 </div>
</div>
<% unless(@no_links) %>
<%= bottom_links_for_edit %>
<% end %>
<script type="text/javascript">
//<![CDATA[



function onready_edit_call() {
if (typeof(jQuery) != 'undefined') {

$('body').on('click','#test_query', function() {
 var tabsel = $($('.table_select')[0]);
 if ( tabsel && tabsel.val() ) {
  $.ajax({
    type: 'POST',
    url: '/' + tabsel.val() + '/search?table=' + tabsel.val(),
    data: $('.test_query').closest('form').serialize()}).done(function(data) {
    $('#query_results').html(data);
  });
 }
})

} else {

$('test_query').observe('click', function () {

 var tabsel = $($$('.table_select')[0]);
 if ( tabsel && tabsel.value ) {
  new Ajax.Updater('query_results', '/' + tabsel.value + '/search',
    {method: 'post', parameters: serialize_not_empty($('test_query').up('form')) + 
      '&table='+ tabsel.value });
 }
})
}
}
<% if request.xhr? %>onready_edit_call();<% else %> if (document.observe) {
document.observe('dom:loaded', onready_edit_call)
} else if (typeof(jQuery) != 'undefined') {
jQuery(document).ready(onready_edit_call)
}<% end %>



function onload_edit_call() {
if ($("smart_query_<%=  @smart_query.id || 0  %>_table_sid")) { $("smart_query_<%=  @smart_query.id || 0  %>_table_sid").observe('change', function(event) {
if (typeof(jQuery) != 'undefined') {
var selector_id = $('.table_select')[0].attr('id');

$("advanced_search_indicator").show();
$.ajax({
    type: 'POST',
    url: "/smart_queries/change_table/<%= @smart_query.id || 0 %>", 
    data: $(selector_id).closest('form').serialize()
}).done(function(data) {
   $('#conditions').html(data);
}).always(function () {
   $("#advanced_search_indicator").hide();
   Layout.alignValues('conditions');
});
} else {
var selector_id = $$('.table_select')[0].readAttribute('id');

new Ajax.Updater('conditions',
 "/smart_queries/change_table/<%= @smart_query.id || 0 %>", 
 { asynchronous: true, 
   evalScripts:  true, 
   parameters: Form.serialize($(selector_id).up('form')) + "&table=" + $F(selector_id),
   onLoading: function() {$("advanced_search_indicator").show();},
   onComplete: function() {
     $("advanced_search_indicator").hide();
     Layout.alignValues('conditions');
   }
 }
);
}
}) };
if (typeof(Layout) == 'undefined') { if ($('main-menubar')) { build_menubar('main-menubar') }}
}
<% if request.xhr? %>onload_edit_call();<% else %>if (typeof(Event) != 'undefined' && Event.observe) {
Event.observe(window, 'load', onload_edit_call)
} else if (typeof(jQuery) != 'undefined') {
$(window).load(onload_edit_call)
}<% end %>


//]]>
</script>