<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class User - Rails Application Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/models/user.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="ActiveRecord/Base.html">ActiveRecord::Base</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-assoc_sids_to_columns">::assoc_sids_to_columns</a>
    
    <li><a href="#method-c-from_kml">::from_kml</a>
    
    <li><a href="#method-c-load_from_params">::load_from_params</a>
    
    <li><a href="#method-c-named_scope_active_filter_method">::named_scope_active_filter_method</a>
    
    <li><a href="#method-c-named_scope_default_scope_method">::named_scope_default_scope_method</a>
    
    <li><a href="#method-c-named_scope_except_domain_method">::named_scope_except_domain_method</a>
    
    <li><a href="#method-c-named_scope_with_domain_method">::named_scope_with_domain_method</a>
    
    <li><a href="#method-c-named_scope_with_mail_method">::named_scope_with_mail_method</a>
    
    <li><a href="#method-c-report_calculation">::report_calculation</a>
    
    <li><a href="#method-c-search">::search</a>
    
    <li><a href="#method-c-sign_on">::sign_on</a>
    
    <li><a href="#method-c-validates_as_email_243_for_email">::validates_as_email_243_for_email</a>
    
    <li><a href="#method-i-accesses-3D">#accesses=</a>
    
    <li><a href="#method-i-accesses__potential_values">#accesses__potential_values</a>
    
    <li><a href="#method-i-accesses_human_display">#accesses_human_display</a>
    
    <li><a href="#method-i-accesses_load_from_params">#accesses_load_from_params</a>
    
    <li><a href="#method-i-can_run-3F">#can_run?</a>
    
    <li><a href="#method-i-can_run_by_profile-3F">#can_run_by_profile?</a>
    
    <li><a href="#method-i-can_run_self-3F">#can_run_self?</a>
    
    <li><a href="#method-i-customers__potential_values">#customers__potential_values</a>
    
    <li><a href="#method-i-customers_human_display">#customers_human_display</a>
    
    <li><a href="#method-i-customers_load_from_params">#customers_load_from_params</a>
    
    <li><a href="#method-i-dev_feedbacks__potential_values">#dev_feedbacks__potential_values</a>
    
    <li><a href="#method-i-dev_feedbacks_human_display">#dev_feedbacks_human_display</a>
    
    <li><a href="#method-i-dev_feedbacks_load_from_params">#dev_feedbacks_load_from_params</a>
    
    <li><a href="#method-i-disp_name">#disp_name</a>
    
    <li><a href="#method-i-email_welcome_and_pass">#email_welcome_and_pass</a>
    
    <li><a href="#method-i-file_imports__potential_values">#file_imports__potential_values</a>
    
    <li><a href="#method-i-file_imports_human_display">#file_imports_human_display</a>
    
    <li><a href="#method-i-file_imports_load_from_params">#file_imports_load_from_params</a>
    
    <li><a href="#method-i-has_profile-3F">#has_profile?</a>
    
    <li><a href="#method-i-home_page">#home_page</a>
    
    <li><a href="#method-i-is_admin-3F">#is_admin?</a>
    
    <li><a href="#method-i-language__potential_values">#language__potential_values</a>
    
    <li><a href="#method-i-next">#next</a>
    
    <li><a href="#method-i-password-3D">#password=</a>
    
    <li><a href="#method-i-previous">#previous</a>
    
    <li><a href="#method-i-profiles__potential_values">#profiles__potential_values</a>
    
    <li><a href="#method-i-profiles_human_display">#profiles_human_display</a>
    
    <li><a href="#method-i-profiles_load_from_params">#profiles_load_from_params</a>
    
    <li><a href="#method-i-set_default_password">#set_default_password</a>
    
    <li><a href="#method-i-set_default_profiles">#set_default_profiles</a>
    
    <li><a href="#method-i-user_accesses__potential_values">#user_accesses__potential_values</a>
    
    <li><a href="#method-i-user_accesses_human_display">#user_accesses_human_display</a>
    
    <li><a href="#method-i-user_accesses_load_from_params">#user_accesses_load_from_params</a>
    
    <li><a href="#method-i-users_ids">#users_ids</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Faveod.html">Faveod</a>
  
    <li><a href="./Faveod/AVBBFTranslationService.html">Faveod::AVBBFTranslationService</a>
  
    <li><a href="./Faveod/ActiveResourceExtensions.html">Faveod::ActiveResourceExtensions</a>
  
    <li><a href="./Faveod/ActiveResourceExtensions/ClassMethods.html">Faveod::ActiveResourceExtensions::ClassMethods</a>
  
    <li><a href="./Faveod/DistributedColors.html">Faveod::DistributedColors</a>
  
    <li><a href="./Faveod/GoogleTranslationService.html">Faveod::GoogleTranslationService</a>
  
    <li><a href="./Faveod/GraphMaker.html">Faveod::GraphMaker</a>
  
    <li><a href="./Faveod/HtmlTruncator.html">Faveod::HtmlTruncator</a>
  
    <li><a href="./Faveod/IePdfHeadersMiddleware.html">Faveod::IePdfHeadersMiddleware</a>
  
    <li><a href="./Faveod/PoUtils.html">Faveod::PoUtils</a>
  
    <li><a href="./Faveod/TranslationServer.html">Faveod::TranslationServer</a>
  
    <li><a href="./Faveod/TranslationServicesHelper.html">Faveod::TranslationServicesHelper</a>
  
    <li><a href="./Faveod/Validations.html">Faveod::Validations</a>
  
    <li><a href="./Faveod/Validations/Syntax.html">Faveod::Validations::Syntax</a>
  
    <li><a href="./Faveod/Validations/Syntax/ClassMethods.html">Faveod::Validations::Syntax::ClassMethods</a>
  
    <li><a href="./ActiveRecord.html">ActiveRecord</a>
  
    <li><a href="./ActiveRecord/Base.html">ActiveRecord::Base</a>
  
    <li><a href="./ActiveRecord/Condition.html">ActiveRecord::Condition</a>
  
    <li><a href="./ActiveRecord/ConnectionAdapters.html">ActiveRecord::ConnectionAdapters</a>
  
    <li><a href="./ActiveRecord/ConnectionAdapters/Column.html">ActiveRecord::ConnectionAdapters::Column</a>
  
    <li><a href="./ActiveRecord/Validations.html">ActiveRecord::Validations</a>
  
    <li><a href="./ActiveRecord/Validations/ClassMethods.html">ActiveRecord::Validations::ClassMethods</a>
  
    <li><a href="./ActionView.html">ActionView</a>
  
    <li><a href="./ActionView/Helpers.html">ActionView::Helpers</a>
  
    <li><a href="./ActionView/Helpers/FormOptionsHelper.html">ActionView::Helpers::FormOptionsHelper</a>
  
    <li><a href="./DefaultFinder.html">DefaultFinder</a>
  
    <li><a href="./DefaultFinder/Finder.html">DefaultFinder::Finder</a>
  
    <li><a href="./DefaultFinder/Finder/ClassMethods.html">DefaultFinder::Finder::ClassMethods</a>
  
    <li><a href="./IrbjaxEngine.html">IrbjaxEngine</a>
  
    <li><a href="./IrbjaxEngine/IrbjaxSession.html">IrbjaxEngine::IrbjaxSession</a>
  
    <li><a href="./IrbjaxEngine/Output.html">IrbjaxEngine::Output</a>
  
    <li><a href="./SymetrieCom.html">SymetrieCom</a>
  
    <li><a href="./SymetrieCom/Acts.html">SymetrieCom::Acts</a>
  
    <li><a href="./SymetrieCom/Acts/BetterNestedSetHelper.html">SymetrieCom::Acts::BetterNestedSetHelper</a>
  
    <li><a href="./GetText.html">GetText</a>
  
    <li><a href="./GetText/PoParser.html">GetText::PoParser</a>
  
    <li><a href="./Rack.html">Rack</a>
  
    <li><a href="./Rack/Utils.html">Rack::Utils</a>
  
    <li><a href="./WillPaginate.html">WillPaginate</a>
  
    <li><a href="./WillPaginate/ViewHelpers.html">WillPaginate::ViewHelpers</a>
  
    <li><a href="./AbstractReport.html">AbstractReport</a>
  
    <li><a href="./Access.html">Access</a>
  
    <li><a href="./AccessApi.html">AccessApi</a>
  
    <li><a href="./AccessReport.html">AccessReport</a>
  
    <li><a href="./AccessesController.html">AccessesController</a>
  
    <li><a href="./AccessesHelper.html">AccessesHelper</a>
  
    <li><a href="./AppLocale.html">AppLocale</a>
  
    <li><a href="./AppLocaleApi.html">AppLocaleApi</a>
  
    <li><a href="./AppLocalesController.html">AppLocalesController</a>
  
    <li><a href="./AppLocalesHelper.html">AppLocalesHelper</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./BgWorker.html">BgWorker</a>
  
    <li><a href="./BgWorkerApi.html">BgWorkerApi</a>
  
    <li><a href="./BgWorkerReport.html">BgWorkerReport</a>
  
    <li><a href="./BgWorkersController.html">BgWorkersController</a>
  
    <li><a href="./BgWorkersHelper.html">BgWorkersHelper</a>
  
    <li><a href="./Customer.html">Customer</a>
  
    <li><a href="./CustomerApi.html">CustomerApi</a>
  
    <li><a href="./CustomersController.html">CustomersController</a>
  
    <li><a href="./CustomersHelper.html">CustomersHelper</a>
  
    <li><a href="./Date.html">Date</a>
  
    <li><a href="./DateHelper.html">DateHelper</a>
  
    <li><a href="./DevFeedback.html">DevFeedback</a>
  
    <li><a href="./DevFeedbackApi.html">DevFeedbackApi</a>
  
    <li><a href="./DevFeedbacksController.html">DevFeedbacksController</a>
  
    <li><a href="./DevFeedbacksHelper.html">DevFeedbacksHelper</a>
  
    <li><a href="./Enumerable.html">Enumerable</a>
  
    <li><a href="./FileImport.html">FileImport</a>
  
    <li><a href="./FileImportApi.html">FileImportApi</a>
  
    <li><a href="./FileImportReport.html">FileImportReport</a>
  
    <li><a href="./FileImportsController.html">FileImportsController</a>
  
    <li><a href="./FileImportsHelper.html">FileImportsHelper</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./PdfHandler.html">PdfHandler</a>
  
    <li><a href="./Profile.html">Profile</a>
  
    <li><a href="./ProfileAccess.html">ProfileAccess</a>
  
    <li><a href="./ProfileAccessApi.html">ProfileAccessApi</a>
  
    <li><a href="./ProfileAccessesController.html">ProfileAccessesController</a>
  
    <li><a href="./ProfileAccessesHelper.html">ProfileAccessesHelper</a>
  
    <li><a href="./ProfileApi.html">ProfileApi</a>
  
    <li><a href="./ProfilesController.html">ProfilesController</a>
  
    <li><a href="./ProfilesHelper.html">ProfilesHelper</a>
  
    <li><a href="./RBeautify.html">RBeautify</a>
  
    <li><a href="./Range.html">Range</a>
  
    <li><a href="./SavedReport.html">SavedReport</a>
  
    <li><a href="./SavedReportApi.html">SavedReportApi</a>
  
    <li><a href="./SavedReportsController.html">SavedReportsController</a>
  
    <li><a href="./SavedReportsHelper.html">SavedReportsHelper</a>
  
    <li><a href="./SmartQueriesController.html">SmartQueriesController</a>
  
    <li><a href="./SmartQueriesHelper.html">SmartQueriesHelper</a>
  
    <li><a href="./SmartQuery.html">SmartQuery</a>
  
    <li><a href="./SmartQueryApi.html">SmartQueryApi</a>
  
    <li><a href="./SystemSetting.html">SystemSetting</a>
  
    <li><a href="./SystemSettingApi.html">SystemSettingApi</a>
  
    <li><a href="./SystemSettingsController.html">SystemSettingsController</a>
  
    <li><a href="./SystemSettingsHelper.html">SystemSettingsHelper</a>
  
    <li><a href="./Thumbnailer.html">Thumbnailer</a>
  
    <li><a href="./Translation.html">Translation</a>
  
    <li><a href="./TranslationApi.html">TranslationApi</a>
  
    <li><a href="./TranslationsController.html">TranslationsController</a>
  
    <li><a href="./TranslationsHelper.html">TranslationsHelper</a>
  
    <li><a href="./UncatchedException.html">UncatchedException</a>
  
    <li><a href="./UncatchedExceptionApi.html">UncatchedExceptionApi</a>
  
    <li><a href="./UncatchedExceptionMailer.html">UncatchedExceptionMailer</a>
  
    <li><a href="./UncatchedExceptionsController.html">UncatchedExceptionsController</a>
  
    <li><a href="./UncatchedExceptionsHelper.html">UncatchedExceptionsHelper</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UserAccess.html">UserAccess</a>
  
    <li><a href="./UserAccessApi.html">UserAccessApi</a>
  
    <li><a href="./UserAccessesController.html">UserAccessesController</a>
  
    <li><a href="./UserAccessesHelper.html">UserAccessesHelper</a>
  
    <li><a href="./UserApi.html">UserApi</a>
  
    <li><a href="./UserMailer.html">UserMailer</a>
  
    <li><a href="./UserReport.html">UserReport</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersHelper.html">UsersHelper</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class User</h1>

  <div id="description" class="description">
    
<pre>This file and all its content belong to Faveod S.A.S unless a commercial
contract signed by a representant of Faveod S.A.S states otherwise.</pre>

<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
DEALINGS IN THE SOFTWARE.</p>

<pre>This has been generated by Faveod Generator on Thu Oct 31 16:41:16 +0100 2013
It should be placed at 'app/models/user.rb'
All manual modifications will be destroyed on next generation</pre>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="COMPARATORS">COMPARATORS
        
        <dd class="description">
        
      
        <dt id="FIELDS">FIELDS
        
        <dd class="description">
        
      
        <dt id="FILES_DEST">FILES_DEST
        
        <dd class="description">
        
      
        <dt id="RESTRICTED_FIELDS">RESTRICTED_FIELDS
        
        <dd class="description">
        
      
        <dt id="SEARCHABLE_FIELDS">SEARCHABLE_FIELDS
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    
    <!-- Attributes -->
    <section id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="attribute-i-accesses_was" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">accesses_was</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-customers_was" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">customers_was</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-dev_feedbacks_was" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">dev_feedbacks_was</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-file_imports_was" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">file_imports_was</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-password" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">password</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>Virtual Fields</p>
        
        </div>
      </div>
      
      <div id="attribute-i-profiles_was" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">profiles_was</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-user_accesses_was" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">user_accesses_was</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section><!-- attribute-method-details -->
    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-assoc_sids_to_columns" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">assoc_sids_to_columns</span><span
            class="method-args">(attrs)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="assoc_sids_to_columns-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1331</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">assoc_sids_to_columns</span>(<span class="ruby-identifier">attrs</span>)
<span class="ruby-identifier">h</span> = <span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:conditions</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">attrs</span>[<span class="ruby-value">:conditions</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">attrs</span>
<span class="ruby-keyword">if</span> <span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:conditions</span>)
  <span class="ruby-identifier">attrs</span>[<span class="ruby-value">:conditions</span>] = <span class="ruby-identifier">h</span>
  <span class="ruby-identifier">attrs</span>
<span class="ruby-keyword">else</span>
  <span class="ruby-identifier">h</span>
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- assoc_sids_to_columns-source -->
          
        </div>

        

        
      </div><!-- assoc_sids_to_columns-method -->

    
      <div id="method-c-from_kml" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">from_kml</span><span
            class="method-args">(path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Import maps elements from KML format.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>2</p>
</dd><dt>Last Update
<dd>
<p>2012-10-18 22:14:54 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="from_kml-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 888</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">from_kml</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">doc</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">path</span>))
  <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">css</span>(<span class="ruby-string">'Placemark'</span>).<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">pi</span> = <span class="ruby-identifier">l</span>.<span class="ruby-identifier">css</span>(<span class="ruby-string">'Data[name=Name] value'</span>)[<span class="ruby-value">0</span>].<span class="ruby-identifier">content</span>.<span class="ruby-identifier">strip</span>
    <span class="ruby-identifier">country</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-identifier">pi</span>)
    <span class="ruby-identifier">poly</span> = <span class="ruby-identifier">l</span>.<span class="ruby-identifier">css</span>(<span class="ruby-string">'Polygon'</span>).<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">p</span>.<span class="ruby-identifier">content</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">%r,0\.0/</span>, <span class="ruby-string">','</span>).<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:to_f</span>)
    }.<span class="ruby-identifier">flatten</span>
    (<span class="ruby-identifier">poly</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>).<span class="ruby-identifier">times</span>{
      <span class="ruby-identifier">country</span>.<span class="ruby-identifier">user_borders</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:lat</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">poly</span>.<span class="ruby-identifier">shift</span>, <span class="ruby-value">:lng</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">poly</span>.<span class="ruby-identifier">shift</span>)
    }
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- from_kml-source -->
          
        </div>

        

        
      </div><!-- from_kml-method -->

    
      <div id="method-c-load_from_params" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_from_params</span><span
            class="method-args">(att)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Load the matching object with right attributes.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Sylvain Abélard</p>
</dd><dt>Version
<dd>
<p>53</p>
</dd><dt>Last Update
<dd>
<p>2013-09-03 16:56:08 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="load_from_params-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 133</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">load_from_params</span>(<span class="ruby-identifier">att</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">att</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-identifier">std_atts</span> = <span class="ruby-identifier">att</span>.<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-node">%w(id customers user_accesses accesses profiles dev_feedbacks file_imports)</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_s</span>) }
  <span class="ruby-identifier">user</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">att</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:id</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">att</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-comment"># Useful for HasOne (ho_assoc)</span>
    <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">att</span>[<span class="ruby-value">:id</span>])
    <span class="ruby-identifier">user</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">std_atts</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">std_atts</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># clean associations</span>

  <span class="ruby-identifier">user</span>.<span class="ruby-identifier">customers_load_from_params</span>(<span class="ruby-identifier">att</span>[<span class="ruby-value">:customers</span>])
  <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_accesses_load_from_params</span>(<span class="ruby-identifier">att</span>[<span class="ruby-value">:user_accesses</span>])
  <span class="ruby-identifier">user</span>.<span class="ruby-identifier">accesses_load_from_params</span>(<span class="ruby-identifier">att</span>[<span class="ruby-value">:accesses</span>])
  <span class="ruby-identifier">user</span>.<span class="ruby-identifier">profiles_load_from_params</span>(<span class="ruby-identifier">att</span>[<span class="ruby-value">:profiles</span>])
  <span class="ruby-identifier">user</span>.<span class="ruby-identifier">dev_feedbacks_load_from_params</span>(<span class="ruby-identifier">att</span>[<span class="ruby-value">:dev_feedbacks</span>])
  <span class="ruby-identifier">user</span>.<span class="ruby-identifier">file_imports_load_from_params</span>(<span class="ruby-identifier">att</span>[<span class="ruby-value">:file_imports</span>])

  <span class="ruby-comment">#clean binaries</span>
  <span class="ruby-comment">#clean serialized data</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">user</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- load_from_params-source -->
          
        </div>

        

        
      </div><!-- load_from_params-method -->

    
      <div id="method-c-named_scope_active_filter_method" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">named_scope_active_filter_method</span><span
            class="method-args">(hash)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>9</p>
</dd><dt>Last Update
<dd>
<p>2013-02-03 20:51:21 UTC</p>
</dd></dl>
          

          
          <div class="method-source-code" id="named_scope_active_filter_method-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 987</span>
  <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">named_scope_active_filter_method</span>(<span class="ruby-identifier">hash</span>)

    <span class="ruby-comment">#hash looks like {'field1' =&gt; {'op' =&gt; value}, 'field2' =&gt; ... }</span>
    <span class="ruby-comment">#op could be =, !=, ^=, $=, =~, !~, &gt;, &lt;, &gt;=, &lt;=, IN, FTS...</span>

    <span class="ruby-identifier">hash</span> <span class="ruby-operator">||=</span> {}
    <span class="ruby-identifier">values</span> = []
    <span class="ruby-identifier">joins_fields</span> = []
    <span class="ruby-identifier">_scopes</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">hash</span>[<span class="ruby-string">'_scopes'</span>].<span class="ruby-identifier">blank?</span>
      (<span class="ruby-node">%w()</span> &amp; <span class="ruby-identifier">hash</span>[<span class="ruby-string">'_scopes'</span>]).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">_scopes</span> = (<span class="ruby-identifier">_scopes</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>).<span class="ruby-identifier">send</span>(<span class="ruby-identifier">s</span>.<span class="ruby-identifier">to_sym</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">str</span> = <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">field</span>, <span class="ruby-identifier">pairs</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">to_sym</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:customers</span>, <span class="ruby-value">:user_id</span>
        <span class="ruby-identifier">joins_fields</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">:customers</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:user_accesses</span>, <span class="ruby-value">:user_id</span>
        <span class="ruby-identifier">joins_fields</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">:user_accesses</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:profiles</span>, <span class="ruby-value">:user_id</span>
        <span class="ruby-identifier">joins_fields</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">:profiles</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:dev_feedbacks</span>, <span class="ruby-value">:user_id</span>
        <span class="ruby-identifier">joins_fields</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">:dev_feedbacks</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:file_imports</span>, <span class="ruby-value">:user_id</span>
        <span class="ruby-identifier">joins_fields</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">:file_imports</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> [<span class="ruby-value">:login</span>, <span class="ruby-value">:first_name</span>, <span class="ruby-value">:last_name</span>, <span class="ruby-value">:email</span>, <span class="ruby-value">:customers</span>, <span class="ruby-value">:user_id</span>, <span class="ruby-value">:telephone</span>, <span class="ruby-value">:language</span>, <span class="ruby-value">:active</span>, <span class="ruby-value">:hashed_password</span>, <span class="ruby-value">:salt</span>, <span class="ruby-value">:last_login</span>, <span class="ruby-value">:last_session_id</span>, <span class="ruby-value">:user_accesses</span>, <span class="ruby-value">:profiles</span>, <span class="ruby-value">:dev_feedbacks</span>, <span class="ruby-value">:file_imports</span>
      ].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">field</span>.<span class="ruby-identifier">to_sym</span>)
      <span class="ruby-constant">Array</span>(<span class="ruby-identifier">pairs</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">op</span>,<span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">cmp</span> = <span class="ruby-constant">COMPARATORS</span>[<span class="ruby-identifier">field</span>.<span class="ruby-identifier">to_sym</span>][<span class="ruby-identifier">op</span>]
        <span class="ruby-identifier">values</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">cmp</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">cmp</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">%</span> <span class="ruby-identifier">val</span>)) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cmp</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cmp</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">''</span>
        <span class="ruby-identifier">cmp</span>[<span class="ruby-value">0</span>]
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">elsif</span> [
    ].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">field</span>.<span class="ruby-identifier">to_sym</span>)
    <span class="ruby-constant">Array</span>(<span class="ruby-identifier">pairs</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">op</span>,<span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">cmp</span> = <span class="ruby-constant">COMPARATORS</span>[<span class="ruby-identifier">field</span>.<span class="ruby-identifier">to_sym</span>][<span class="ruby-identifier">op</span>]
      <span class="ruby-identifier">values</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Array</span>(<span class="ruby-identifier">val</span>)
      <span class="ruby-string">&quot;(%s)&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">cmp</span>[<span class="ruby-value">0</span>] }.<span class="ruby-identifier">join</span>(<span class="ruby-string">' OR '</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
}.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">' AND '</span>)
<span class="ruby-keyword">if</span> <span class="ruby-identifier">_scopes</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">_scopes</span>.<span class="ruby-identifier">proxy_options</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">_scopes</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-identifier">joins_fields</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">values</span>.<span class="ruby-identifier">insert</span>(<span class="ruby-value">0</span>, <span class="ruby-identifier">str</span>)).<span class="ruby-identifier">proxy_options</span>
<span class="ruby-keyword">else</span>
  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">joins_fields</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> {} <span class="ruby-operator">:</span> {<span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">joins_fields</span>}
  <span class="ruby-identifier">res</span>[<span class="ruby-value">:conditions</span>] = <span class="ruby-identifier">values</span>.<span class="ruby-identifier">insert</span>(<span class="ruby-value">0</span>, <span class="ruby-identifier">str</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">res</span>
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- named_scope_active_filter_method-source -->
          
        </div>

        

        
      </div><!-- named_scope_active_filter_method-method -->

    
      <div id="method-c-named_scope_default_scope_method" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">named_scope_default_scope_method</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>5</p>
</dd><dt>Last Update
<dd>
<p>2009-11-01 16:01:43 UTC</p>
</dd></dl>
          

          
          <div class="method-source-code" id="named_scope_default_scope_method-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 975</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">named_scope_default_scope_method</span>

  {}
<span class="ruby-keyword">end</span></pre>
          </div><!-- named_scope_default_scope_method-source -->
          
        </div>

        

        
      </div><!-- named_scope_default_scope_method-method -->

    
      <div id="method-c-named_scope_except_domain_method" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">named_scope_except_domain_method</span><span
            class="method-args">(domain)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Sylvain Abélard</p>
</dd><dt>Version
<dd>
<p>1</p>
</dd><dt>Last Update
<dd>
<p>2010-04-19 15:03:16 UTC</p>
</dd></dl>
          

          
          <div class="method-source-code" id="named_scope_except_domain_method-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 942</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">named_scope_except_domain_method</span>(<span class="ruby-identifier">domain</span>)
  {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;email NOT LIKE '%@#{domain}'&quot;</span>}
<span class="ruby-keyword">end</span></pre>
          </div><!-- named_scope_except_domain_method-source -->
          
        </div>

        

        
      </div><!-- named_scope_except_domain_method-method -->

    
      <div id="method-c-named_scope_with_domain_method" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">named_scope_with_domain_method</span><span
            class="method-args">(domain)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Sylvain Abélard</p>
</dd><dt>Version
<dd>
<p>1</p>
</dd><dt>Last Update
<dd>
<p>2010-04-19 15:04:04 UTC</p>
</dd></dl>
          

          
          <div class="method-source-code" id="named_scope_with_domain_method-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 953</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">named_scope_with_domain_method</span>(<span class="ruby-identifier">domain</span>)
  {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;email LIKE '%@#{domain}'&quot;</span>}
<span class="ruby-keyword">end</span></pre>
          </div><!-- named_scope_with_domain_method-source -->
          
        </div>

        

        
      </div><!-- named_scope_with_domain_method-method -->

    
      <div id="method-c-named_scope_with_mail_method" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">named_scope_with_mail_method</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Sylvain Abélard</p>
</dd><dt>Version
<dd>
<p>1</p>
</dd><dt>Last Update
<dd>
<p>2010-04-19 15:04:38 UTC</p>
</dd></dl>
          

          
          <div class="method-source-code" id="named_scope_with_mail_method-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 964</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">named_scope_with_mail_method</span>
  {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;email IS NOT NULL&quot;</span>}
<span class="ruby-keyword">end</span></pre>
          </div><!-- named_scope_with_mail_method-source -->
          
        </div>

        

        
      </div><!-- named_scope_with_mail_method-method -->

    
      <div id="method-c-report_calculation" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">report_calculation</span><span
            class="method-args">(op, field = :id, opts = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Makes all kind of calculations for reports.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>20</p>
</dd><dt>Last Update
<dd>
<p>2013-02-27 12:27:37 UTC</p>
</dd><dt>Status
<dd>
<p>Should be optimized</p>
</dd></dl>
          

          
          <div class="method-source-code" id="report_calculation-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 234</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">report_calculation</span>(<span class="ruby-identifier">op</span>, <span class="ruby-identifier">field</span> = <span class="ruby-value">:id</span>, <span class="ruby-identifier">opts</span> = {})
  <span class="ruby-identifier">scope</span>       = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:scope</span>]
  <span class="ruby-identifier">labels</span>      = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:labels</span>]        <span class="ruby-operator">||</span> []
  <span class="ruby-identifier">step</span>        = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:step</span>]
  <span class="ruby-identifier">group</span>       = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:group</span>]
  <span class="ruby-identifier">ret_hash</span>= <span class="ruby-identifier">opts</span>[<span class="ruby-value">:ret_hash</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opsym</span>       = <span class="ruby-keyword">case</span> <span class="ruby-identifier">op</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:count</span>, <span class="ruby-string">'count'</span>                        <span class="ruby-keyword">then</span> <span class="ruby-identifier">field</span> = <span class="ruby-value">:id</span> ; <span class="ruby-value">:count</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:avg</span>, <span class="ruby-string">'avg'</span>, <span class="ruby-string">'average'</span>, <span class="ruby-value">:average</span>       <span class="ruby-keyword">then</span> <span class="ruby-value">:avg</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:value</span>, <span class="ruby-string">'value'</span>, <span class="ruby-value">:sum</span>, <span class="ruby-string">'sum'</span>   <span class="ruby-keyword">then</span> <span class="ruby-value">:sum</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:min</span>, <span class="ruby-string">'min'</span>, <span class="ruby-value">:minimum</span>, <span class="ruby-string">'minimum'</span>       <span class="ruby-keyword">then</span> <span class="ruby-value">:min</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:max</span>, <span class="ruby-string">'max'</span>, <span class="ruby-value">:maximum</span>, <span class="ruby-string">'maximum'</span>       <span class="ruby-keyword">then</span> <span class="ruby-value">:max</span>
  <span class="ruby-keyword">else</span> <span class="ruby-identifier">field</span> = <span class="ruby-value">:id</span> ; <span class="ruby-value">:count</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">group</span>
  <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) { <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>) }
  <span class="ruby-keyword">when</span> <span class="ruby-value">:profiles</span>, <span class="ruby-string">'profiles'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_id</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:profiles</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_id</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:profiles</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">l</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">:</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">id</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>])) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:customers</span>, <span class="ruby-string">'customers'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_id</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:customers</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_id</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:customers</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">l</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">:</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">id</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>])) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:user_accesses</span>, <span class="ruby-string">'user_accesses'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_id</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_accesses</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_id</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_accesses</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">l</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">:</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">id</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>])) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:dev_feedbacks</span>, <span class="ruby-string">'dev_feedbacks'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_id</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_id</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">l</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">:</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">id</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>])) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:file_imports</span>, <span class="ruby-string">'file_imports'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_id</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:file_imports</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_id</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:file_imports</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">l</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">:</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">id</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>])) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:accesses</span>, <span class="ruby-string">'accesses'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;users.id&quot;</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:accesses</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;users.id&quot;</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:accesses</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">l</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">:</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">id</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>])) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:active</span>, <span class="ruby-string">'active'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'active'</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'active'</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">ret_hash</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">h</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">serie</span> = []
      <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span>,<span class="ruby-identifier">idx</span><span class="ruby-operator">|</span> <span class="ruby-identifier">serie</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>)}
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">serie</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;user_accesses.read&quot;</span>, <span class="ruby-string">'user_accesses.read'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'user_accesses.read'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_accesses</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'user_accesses.read'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_accesses</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">ret_hash</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">h</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">serie</span> = []
      <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span>,<span class="ruby-identifier">idx</span><span class="ruby-operator">|</span> <span class="ruby-identifier">serie</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>)}
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">serie</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;user_accesses.write&quot;</span>, <span class="ruby-string">'user_accesses.write'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'user_accesses.write'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_accesses</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'user_accesses.write'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user_accesses</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">ret_hash</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">h</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">serie</span> = []
      <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span>,<span class="ruby-identifier">idx</span><span class="ruby-operator">|</span> <span class="ruby-identifier">serie</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>)}
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">serie</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;dev_feedbacks.ticket_status&quot;</span>, <span class="ruby-string">'dev_feedbacks.ticket_status'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.ticket_status'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.ticket_status'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">ret_hash</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">h</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">serie</span> = []
      <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span>,<span class="ruby-identifier">idx</span><span class="ruby-operator">|</span> <span class="ruby-identifier">serie</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>)}
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">serie</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:login</span>, <span class="ruby-string">'login'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'login'</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'login'</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:first_name</span>, <span class="ruby-string">'first_name'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'first_name'</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'first_name'</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:last_name</span>, <span class="ruby-string">'last_name'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'last_name'</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'last_name'</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:email</span>, <span class="ruby-string">'email'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'email'</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'email'</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:telephone</span>, <span class="ruby-string">'telephone'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'telephone'</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'telephone'</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:language</span>, <span class="ruby-string">'language'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'language'</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'language'</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:password</span>, <span class="ruby-string">'password'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'password'</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'password'</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:hashed_password</span>, <span class="ruby-string">'hashed_password'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'hashed_password'</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'hashed_password'</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:salt</span>, <span class="ruby-string">'salt'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'salt'</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'salt'</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:last_session_id</span>, <span class="ruby-string">'last_session_id'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'last_session_id'</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'last_session_id'</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;customers.first_name&quot;</span>, <span class="ruby-string">'customers.first_name'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'customers.first_name'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:customers</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'customers.first_name'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:customers</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;customers.last_name&quot;</span>, <span class="ruby-string">'customers.last_name'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'customers.last_name'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:customers</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'customers.last_name'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:customers</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;customers.new_string&quot;</span>, <span class="ruby-string">'customers.new_string'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'customers.new_string'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:customers</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'customers.new_string'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:customers</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;accesses.app_sid&quot;</span>, <span class="ruby-string">'accesses.app_sid'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'accesses.app_sid'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:accesses</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'accesses.app_sid'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:accesses</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;accesses.set_sid&quot;</span>, <span class="ruby-string">'accesses.set_sid'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'accesses.set_sid'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:accesses</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'accesses.set_sid'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:accesses</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;accesses.table_sid&quot;</span>, <span class="ruby-string">'accesses.table_sid'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'accesses.table_sid'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:accesses</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'accesses.table_sid'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:accesses</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;accesses.field_sid&quot;</span>, <span class="ruby-string">'accesses.field_sid'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'accesses.field_sid'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:accesses</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'accesses.field_sid'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:accesses</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;accesses.action_sid&quot;</span>, <span class="ruby-string">'accesses.action_sid'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'accesses.action_sid'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:accesses</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'accesses.action_sid'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:accesses</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;accesses.type_sid&quot;</span>, <span class="ruby-string">'accesses.type_sid'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'accesses.type_sid'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:accesses</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'accesses.type_sid'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:accesses</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;profiles.name&quot;</span>, <span class="ruby-string">'profiles.name'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'profiles.name'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:profiles</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'profiles.name'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:profiles</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;dev_feedbacks.title&quot;</span>, <span class="ruby-string">'dev_feedbacks.title'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.title'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.title'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;dev_feedbacks.url&quot;</span>, <span class="ruby-string">'dev_feedbacks.url'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.url'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.url'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;dev_feedbacks.controller&quot;</span>, <span class="ruby-string">'dev_feedbacks.controller'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.controller'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.controller'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;dev_feedbacks.action&quot;</span>, <span class="ruby-string">'dev_feedbacks.action'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.action'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.action'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;dev_feedbacks.ip&quot;</span>, <span class="ruby-string">'dev_feedbacks.ip'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.ip'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.ip'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;dev_feedbacks.ua&quot;</span>, <span class="ruby-string">'dev_feedbacks.ua'</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.ua'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.ua'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
      }
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;dev_feedbacks.lft&quot;</span>, <span class="ruby-string">'dev_feedbacks.lft'</span>
    <span class="ruby-identifier">h</span> = {}
    <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:dev_feedbacks</span>).<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;users.dev_feedbacks.lft &gt;= ? AND users.dev_feedbacks.lft &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:dev_feedbacks</span>).<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;users.dev_feedbacks.lft &gt;= ? AND users.dev_feedbacks.lft &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
        }
      <span class="ruby-keyword">end</span>
    }
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;dev_feedbacks.parent_id&quot;</span>, <span class="ruby-string">'dev_feedbacks.parent_id'</span>
    <span class="ruby-identifier">h</span> = {}
    <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:dev_feedbacks</span>).<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;users.dev_feedbacks.parent_id &gt;= ? AND users.dev_feedbacks.parent_id &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:dev_feedbacks</span>).<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;users.dev_feedbacks.parent_id &gt;= ? AND users.dev_feedbacks.parent_id &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
        }
      <span class="ruby-keyword">end</span>
    }
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;dev_feedbacks.rgt&quot;</span>, <span class="ruby-string">'dev_feedbacks.rgt'</span>
    <span class="ruby-identifier">h</span> = {}
    <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:dev_feedbacks</span>).<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;users.dev_feedbacks.rgt &gt;= ? AND users.dev_feedbacks.rgt &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:dev_feedbacks</span>).<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;users.dev_feedbacks.rgt &gt;= ? AND users.dev_feedbacks.rgt &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
        }
      <span class="ruby-keyword">end</span>
    }
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;file_imports.read_lines&quot;</span>, <span class="ruby-string">'file_imports.read_lines'</span>
    <span class="ruby-identifier">h</span> = {}
    <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:file_imports</span>).<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;users.file_imports.read_lines &gt;= ? AND users.file_imports.read_lines &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:file_imports</span>).<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;users.file_imports.read_lines &gt;= ? AND users.file_imports.read_lines &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
        }
      <span class="ruby-keyword">end</span>
    }
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;file_imports.wrote_records&quot;</span>, <span class="ruby-string">'file_imports.wrote_records'</span>
    <span class="ruby-identifier">h</span> = {}
    <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:file_imports</span>).<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;users.file_imports.wrote_records &gt;= ? AND users.file_imports.wrote_records &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:file_imports</span>).<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;users.file_imports.wrote_records &gt;= ? AND users.file_imports.wrote_records &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
        }
      <span class="ruby-keyword">end</span>
    }
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;file_imports.expected_total&quot;</span>, <span class="ruby-string">'file_imports.expected_total'</span>
    <span class="ruby-identifier">h</span> = {}
    <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:file_imports</span>).<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;users.file_imports.expected_total &gt;= ? AND users.file_imports.expected_total &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:file_imports</span>).<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;users.file_imports.expected_total &gt;= ? AND users.file_imports.expected_total &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
        }
      <span class="ruby-keyword">end</span>
    }
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;file_imports.error_count&quot;</span>, <span class="ruby-string">'file_imports.error_count'</span>
    <span class="ruby-identifier">h</span> = {}
    <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:file_imports</span>).<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;users.file_imports.error_count &gt;= ? AND users.file_imports.error_count &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:file_imports</span>).<span class="ruby-identifier">where</span>([<span class="ruby-string">&quot;users.file_imports.error_count &gt;= ? AND users.file_imports.error_count &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
        }
      <span class="ruby-keyword">end</span>
    }
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">when</span> <span class="ruby-value">:last_login</span>, <span class="ruby-string">'last_login'</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:period</span>]
      <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">pgroup</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:period</span>].<span class="ruby-identifier">to_sym</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:day</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%m-%d'</span>
        <span class="ruby-string">&quot;DATE(users.last_login)&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:week</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%W'</span>
        <span class="ruby-string">&quot;CONCAT(YEAR(users.last_login),'-', WEEK(users.last_login))&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:month</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%m'</span>
        <span class="ruby-string">&quot;CONCAT(YEAR(users.last_login),'-', MONTH(users.last_login))&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:year</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y'</span>
        <span class="ruby-string">&quot;YEAR(users.last_login)&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pgroup</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'last_login'</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pgroup</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'last_login'</span>)
        }
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-identifier">lab_format</span>)] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">h</span> = {}
      <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">where</span>([<span class="ruby-node">&quot;users.#{group} &gt;= ? AND users.#{group} &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">where</span>([<span class="ruby-node">&quot;users.#{group} &gt;= ? AND users.#{group} &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
          }
        <span class="ruby-keyword">end</span>
      }
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;customers.new_date&quot;</span>, <span class="ruby-string">'customers.new_date'</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:period</span>]
      <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">pgroup</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:period</span>].<span class="ruby-identifier">to_sym</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:day</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%m-%d'</span>
        <span class="ruby-string">&quot;DATE(customers.new_date)&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:week</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%W'</span>
        <span class="ruby-string">&quot;CONCAT(YEAR(customers.new_date),'-', WEEK(customers.new_date))&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:month</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%m'</span>
        <span class="ruby-string">&quot;CONCAT(YEAR(customers.new_date),'-', MONTH(customers.new_date))&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:year</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y'</span>
        <span class="ruby-string">&quot;YEAR(customers.new_date)&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pgroup</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'customers.new_date'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:customers</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pgroup</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'customers.new_date'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:customers</span>)
        }
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-identifier">lab_format</span>)] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">h</span> = {}
      <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">where</span>([<span class="ruby-node">&quot;users.#{group} &gt;= ? AND users.#{group} &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">where</span>([<span class="ruby-node">&quot;users.#{group} &gt;= ? AND users.#{group} &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
          }
        <span class="ruby-keyword">end</span>
      }
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;dev_feedbacks.created_at&quot;</span>, <span class="ruby-string">'dev_feedbacks.created_at'</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:period</span>]
      <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">pgroup</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:period</span>].<span class="ruby-identifier">to_sym</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:day</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%m-%d'</span>
        <span class="ruby-string">&quot;DATE(dev_feedbacks.created_at)&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:week</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%W'</span>
        <span class="ruby-string">&quot;CONCAT(YEAR(dev_feedbacks.created_at),'-', WEEK(dev_feedbacks.created_at))&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:month</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%m'</span>
        <span class="ruby-string">&quot;CONCAT(YEAR(dev_feedbacks.created_at),'-', MONTH(dev_feedbacks.created_at))&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:year</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y'</span>
        <span class="ruby-string">&quot;YEAR(dev_feedbacks.created_at)&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pgroup</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.created_at'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pgroup</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'dev_feedbacks.created_at'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:dev_feedbacks</span>)
        }
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-identifier">lab_format</span>)] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">h</span> = {}
      <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">where</span>([<span class="ruby-node">&quot;users.#{group} &gt;= ? AND users.#{group} &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">where</span>([<span class="ruby-node">&quot;users.#{group} &gt;= ? AND users.#{group} &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
          }
        <span class="ruby-keyword">end</span>
      }
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;file_imports.started_at&quot;</span>, <span class="ruby-string">'file_imports.started_at'</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:period</span>]
      <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">pgroup</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:period</span>].<span class="ruby-identifier">to_sym</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:day</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%m-%d'</span>
        <span class="ruby-string">&quot;DATE(file_imports.started_at)&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:week</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%W'</span>
        <span class="ruby-string">&quot;CONCAT(YEAR(file_imports.started_at),'-', WEEK(file_imports.started_at))&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:month</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%m'</span>
        <span class="ruby-string">&quot;CONCAT(YEAR(file_imports.started_at),'-', MONTH(file_imports.started_at))&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:year</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y'</span>
        <span class="ruby-string">&quot;YEAR(file_imports.started_at)&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pgroup</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'file_imports.started_at'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:file_imports</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pgroup</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'file_imports.started_at'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:file_imports</span>)
        }
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-identifier">lab_format</span>)] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">h</span> = {}
      <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">where</span>([<span class="ruby-node">&quot;users.#{group} &gt;= ? AND users.#{group} &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">where</span>([<span class="ruby-node">&quot;users.#{group} &gt;= ? AND users.#{group} &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
          }
        <span class="ruby-keyword">end</span>
      }
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;file_imports.completed_at&quot;</span>, <span class="ruby-string">'file_imports.completed_at'</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:period</span>]
      <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">pgroup</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:period</span>].<span class="ruby-identifier">to_sym</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:day</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%m-%d'</span>
        <span class="ruby-string">&quot;DATE(file_imports.completed_at)&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:week</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%W'</span>
        <span class="ruby-string">&quot;CONCAT(YEAR(file_imports.completed_at),'-', WEEK(file_imports.completed_at))&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:month</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y-%m'</span>
        <span class="ruby-string">&quot;CONCAT(YEAR(file_imports.completed_at),'-', MONTH(file_imports.completed_at))&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:year</span>
        <span class="ruby-identifier">lab_format</span> = <span class="ruby-string">'%Y'</span>
        <span class="ruby-string">&quot;YEAR(file_imports.completed_at)&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">h</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pgroup</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'file_imports.completed_at'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:file_imports</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pgroup</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'file_imports.completed_at'</span>, <span class="ruby-value">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:file_imports</span>)
        }
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-identifier">lab_format</span>)] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">h</span> = {}
      <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">blank?</span>
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">where</span>([<span class="ruby-node">&quot;users.#{group} &gt;= ? AND users.#{group} &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-value">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope</span>}) {
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">where</span>([<span class="ruby-node">&quot;users.#{group} &gt;= ? AND users.#{group} &lt; ?&quot;</span>, <span class="ruby-identifier">l</span>, <span class="ruby-identifier">labels</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]).<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">opsym</span>, <span class="ruby-identifier">field</span>)
          }
        <span class="ruby-keyword">end</span>
      }
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">ret_hash</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">h</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">labels</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">l</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Unknown Group: #{group} (operation: #{opsym}, scope: #{scope})&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> []
<span class="ruby-keyword">end</span></pre>
          </div><!-- report_calculation-source -->
          
        </div>

        

        
      </div><!-- report_calculation-method -->

    
      <div id="method-c-search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search</span><span
            class="method-args">(values, comps=nil, opts={})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Search</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>23</p>
</dd><dt>Last Update
<dd>
<p>2011-08-09 11:16:42 UTC</p>
</dd><dt>Status
<dd>
<p>Validation Pending</p>
</dd></dl>
          

          
          <div class="method-source-code" id="search-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 168</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">search</span>(<span class="ruby-identifier">values</span>, <span class="ruby-identifier">comps</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">opts</span>={})
  <span class="ruby-identifier">ar_opts</span> = {}
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">SmartQuery</span>)
    <span class="ruby-identifier">ar_opts</span> = <span class="ruby-identifier">values</span>.<span class="ruby-identifier">to_ar_opts</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">cond</span> = {}
    <span class="ruby-identifier">inc</span> = []
    <span class="ruby-identifier">string_h</span> = {<span class="ruby-string">'='</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-string">'&lt;&gt;'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:ne</span>, <span class="ruby-string">'=~'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:like</span>, <span class="ruby-string">'!=~'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:not</span>,
      <span class="ruby-string">'LIKE'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:eq</span>, <span class="ruby-string">'NOT LIKE'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:ne</span>, <span class="ruby-string">'STARTS WITH'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:starts_with</span>, <span class="ruby-string">'ENDS WITH'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:ends_with</span>,
    <span class="ruby-string">'IS NULL'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-string">'IN'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>}
    <span class="ruby-identifier">numb_h</span> = {<span class="ruby-string">'='</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-string">'&lt;&gt;'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:ne</span>, <span class="ruby-string">'&gt;'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:gt</span>, <span class="ruby-string">'&lt;'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:lt</span>, <span class="ruby-string">'&gt;='</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:gte</span>, <span class="ruby-string">'&lt;='</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:lte</span>, <span class="ruby-string">'IS NULL'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-string">'IN'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>}
    <span class="ruby-identifier">date_h</span> = {<span class="ruby-string">'='</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-string">'&lt;&gt;'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:ne</span>, <span class="ruby-string">'&gt;'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:gt</span>, <span class="ruby-string">'&lt;'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:lt</span>, <span class="ruby-string">'&gt;='</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:gte</span>, <span class="ruby-string">'&lt;='</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:lte</span>, <span class="ruby-string">'IS NULL'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-string">'IN'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>}
    <span class="ruby-identifier">bin_h</span> = {<span class="ruby-string">'is named'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:eq</span>, <span class="ruby-string">'size larger than'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:gte</span>, <span class="ruby-string">'size smaller than'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:lte</span>, <span class="ruby-string">'is not set'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>}
    <span class="ruby-identifier">assoc_h</span> = {<span class="ruby-string">'&lt;&gt;'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:ne</span>, <span class="ruby-string">'='</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-string">'IN'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-string">'IS NULL'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>}
    <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">params_to_attributes</span>(<span class="ruby-identifier">values</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_sym</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:login</span>
        <span class="ruby-identifier">cmp</span> = <span class="ruby-identifier">comps</span>[<span class="ruby-string">&quot;comp_login&quot;</span>]
        <span class="ruby-identifier">cmp</span> <span class="ruby-operator">||=</span> <span class="ruby-string">'STARTS WITH'</span>
        <span class="ruby-identifier">val</span> = <span class="ruby-identifier">cmp</span> <span class="ruby-operator">==</span> <span class="ruby-string">'IS NULL'</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">cmp</span> <span class="ruby-operator">==</span> <span class="ruby-string">'IN'</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">v</span>)
        <span class="ruby-identifier">field</span> = <span class="ruby-identifier">string_h</span>[<span class="ruby-identifier">cmp</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">:login</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;login_#{string_h[cmp]}&quot;</span>
        <span class="ruby-identifier">cond</span>[<span class="ruby-identifier">field</span>] = <span class="ruby-identifier">val</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:customers</span>
        <span class="ruby-identifier">cmp</span> = <span class="ruby-identifier">comps</span>[<span class="ruby-string">&quot;comp_customers&quot;</span>]
        <span class="ruby-identifier">val</span> = <span class="ruby-identifier">cmp</span> <span class="ruby-operator">==</span> <span class="ruby-string">'IS NULL'</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">v</span>
        <span class="ruby-identifier">field</span> = <span class="ruby-identifier">assoc_h</span>[<span class="ruby-identifier">cmp</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-string">'customers.user_id'</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;customers_#{assoc_h[cmp]}&quot;</span>
        <span class="ruby-identifier">cond</span>[<span class="ruby-identifier">field</span>] = <span class="ruby-identifier">val</span>
        <span class="ruby-identifier">inc</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">:customers</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:telephone</span>
        <span class="ruby-identifier">cmp</span> = <span class="ruby-identifier">comps</span>[<span class="ruby-string">&quot;comp_telephone&quot;</span>]
        <span class="ruby-identifier">cmp</span> <span class="ruby-operator">||=</span> <span class="ruby-string">'STARTS WITH'</span>
        <span class="ruby-identifier">val</span> = <span class="ruby-identifier">cmp</span> <span class="ruby-operator">==</span> <span class="ruby-string">'IS NULL'</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">cmp</span> <span class="ruby-operator">==</span> <span class="ruby-string">'IN'</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">v</span>)
        <span class="ruby-identifier">field</span> = <span class="ruby-identifier">string_h</span>[<span class="ruby-identifier">cmp</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">:telephone</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;telephone_#{string_h[cmp]}&quot;</span>
        <span class="ruby-identifier">cond</span>[<span class="ruby-identifier">field</span>] = <span class="ruby-identifier">val</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:dev_feedbacks</span>
        <span class="ruby-identifier">cmp</span> = <span class="ruby-identifier">comps</span>[<span class="ruby-string">&quot;comp_dev_feedbacks&quot;</span>]
        <span class="ruby-identifier">val</span> = <span class="ruby-identifier">cmp</span> <span class="ruby-operator">==</span> <span class="ruby-string">'IS NULL'</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">v</span>
        <span class="ruby-identifier">field</span> = <span class="ruby-identifier">assoc_h</span>[<span class="ruby-identifier">cmp</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-string">'dev_feedbacks.user_id'</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;dev_feedbacks_#{assoc_h[cmp]}&quot;</span>
        <span class="ruby-identifier">cond</span>[<span class="ruby-identifier">field</span>] = <span class="ruby-identifier">val</span>
        <span class="ruby-identifier">inc</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">:dev_feedbacks</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:file_imports</span>
        <span class="ruby-identifier">cmp</span> = <span class="ruby-identifier">comps</span>[<span class="ruby-string">&quot;comp_file_imports&quot;</span>]
        <span class="ruby-identifier">val</span> = <span class="ruby-identifier">cmp</span> <span class="ruby-operator">==</span> <span class="ruby-string">'IS NULL'</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">v</span>
        <span class="ruby-identifier">field</span> = <span class="ruby-identifier">assoc_h</span>[<span class="ruby-identifier">cmp</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-string">'file_imports.user_id'</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;file_imports_#{assoc_h[cmp]}&quot;</span>
        <span class="ruby-identifier">cond</span>[<span class="ruby-identifier">field</span>] = <span class="ruby-identifier">val</span>
        <span class="ruby-identifier">inc</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">:file_imports</span>
      <span class="ruby-keyword">end</span>
    }
    <span class="ruby-identifier">ar_opts</span> = {<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cond</span>}
    <span class="ruby-identifier">ar_opts</span>[<span class="ruby-value">:include</span>] = <span class="ruby-identifier">inc</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">inc</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">ar_opts</span>[<span class="ruby-value">:per_page</span>] = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:per_page</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:per_page</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">count</span>(<span class="ruby-value">:all</span>, <span class="ruby-identifier">ar_opts</span>)
  <span class="ruby-identifier">ar_opts</span>[<span class="ruby-value">:per_page</span>] = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ar_opts</span>[<span class="ruby-value">:per_page</span>] <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">ar_opts</span>[<span class="ruby-value">:page</span>]         = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:page</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:page</span>] <span class="ruby-operator">:</span> <span class="ruby-value">1</span>
  <span class="ruby-identifier">paginate</span>(<span class="ruby-identifier">ar_opts</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- search-source -->
          
        </div>

        

        
      </div><!-- search-method -->

    
      <div id="method-c-sign_on" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sign_on</span><span
            class="method-args">(login, password)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Find matching user.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>5</p>
</dd><dt>Last Update
<dd>
<p>2012-12-25 18:48:23 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="sign_on-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1051</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sign_on</span>(<span class="ruby-identifier">login</span>, <span class="ruby-identifier">password</span>)
<span class="ruby-identifier">user</span> = <span class="ruby-identifier">where</span>(<span class="ruby-value">:login</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">login</span>).<span class="ruby-identifier">first</span>
<span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">active?</span>
<span class="ruby-keyword">return</span> <span class="ruby-identifier">user</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA1</span>.<span class="ruby-identifier">hexdigest</span>(<span class="ruby-identifier">password</span><span class="ruby-operator">+</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">salt</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">hashed_password</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- sign_on-source -->
          
        </div>

        

        
      </div><!-- sign_on-method -->

    
      <div id="method-c-validates_as_email_243_for_email" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validates_as_email_243_for_email</span><span
            class="method-args">(field, options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="validates_as_email_243_for_email-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 56</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">validates_as_email_243_for_email</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">pattern</span> = <span class="ruby-regexp">%r\A(|(([A-Za-z0-9]+_+)|([A-Za-z0-9]+\-+)|([A-Za-z0-9]+\.+)|([A-Za-z0-9]+\++))*[A-Za-z0-9]+@((\w+\-+)|(\w+\.))*\w{1,63}\.[a-zA-Z]{2,6})\Z/</span>

  <span class="ruby-comment"># validates length</span>

  <span class="ruby-identifier">email_len_opts</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:in</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-value">3</span>)<span class="ruby-operator">..</span>(<span class="ruby-value">320</span>))
  <span class="ruby-identifier">validates_length_of</span> <span class="ruby-value">:email</span>, <span class="ruby-identifier">email_len_opts</span>

  <span class="ruby-comment"># validates format</span>

  <span class="ruby-identifier">email_fmt_opts</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>({<span class="ruby-value">:with</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pattern</span>,
  <span class="ruby-value">:message</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">options</span>[<span class="ruby-string">'wrong_format'</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-string">'message'</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">_</span>(<span class="ruby-string">'%{value} is not a valid email address'</span>)) })
  <span class="ruby-identifier">validates_format_of</span> <span class="ruby-value">:email</span>, <span class="ruby-identifier">email_fmt_opts</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- validates_as_email_243_for_email-source -->
          
        </div>

        

        
      </div><!-- validates_as_email_243_for_email-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-accesses-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">accesses=</span><span
            class="method-args">(array)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Associations through specific setters</p>
          

          
          <div class="method-source-code" id="accesses-3D-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">accesses=</span>(<span class="ruby-identifier">array</span>)
  <span class="ruby-identifier">ids</span> = <span class="ruby-identifier">array</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>)
  <span class="ruby-constant">UserAccess</span>.<span class="ruby-identifier">where</span>([<span class="ruby-string">'user_accesses.user_id = ? AND user_accesses.access_id NOT IN (?)'</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">ids</span>]).<span class="ruby-identifier">select</span>(<span class="ruby-value">:id</span>).<span class="ruby-identifier">each</span>(&amp;<span class="ruby-value">:destroy</span>)
  <span class="ruby-identifier">user_access_ids</span> = <span class="ruby-constant">UserAccess</span>.<span class="ruby-identifier">all</span>(<span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:access_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ids</span>}, <span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'access_id'</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:access_id</span>)
  (<span class="ruby-identifier">ids</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">user_access_ids</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">UserAccess</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:access_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>)
  }
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">accesses</span>.<span class="ruby-identifier">reload</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- accesses-3D-source -->
          
        </div>

        

        
      </div><!-- accesses-3D-method -->

    
      <div id="method-i-accesses__potential_values" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">accesses__potential_values</span><span
            class="method-args">(options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>3</p>
</dd><dt>Last Update
<dd>
<p>2012-03-19 01:57:30 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="accesses__potential_values-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1486</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">accesses__potential_values</span>(<span class="ruby-identifier">options</span> = {})
<span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:page</span>)
  <span class="ruby-constant">Access</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">else</span>
  <span class="ruby-constant">Access</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- accesses__potential_values-source -->
          
        </div>

        

        
      </div><!-- accesses__potential_values-method -->

    
      <div id="method-i-accesses_human_display" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">accesses_human_display</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>useful method</p>
          

          
          <div class="method-source-code" id="accesses_human_display-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1294</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">accesses_human_display</span>

<span class="ruby-keyword">return</span> <span class="ruby-identifier">accesses</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">accesses</span>.<span class="ruby-identifier">disp_name</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;&quot;</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- accesses_human_display-source -->
          
        </div>

        

        
      </div><!-- accesses_human_display-method -->

    
      <div id="method-i-accesses_load_from_params" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">accesses_load_from_params</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Load association from different params formats.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>4</p>
</dd><dt>Last Update
<dd>
<p>2013-10-02 15:11:56 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="accesses_load_from_params-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1503</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">accesses_load_from_params</span>(<span class="ruby-identifier">val</span>)

<span class="ruby-keyword">self</span>.<span class="ruby-identifier">accesses_was</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">accesses</span>.<span class="ruby-identifier">all</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span>
<span class="ruby-keyword">case</span> <span class="ruby-identifier">val</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>, <span class="ruby-constant">HashWithIndifferentAccess</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">accesses</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">k</span>[<span class="ruby-regexp">%r\A(_|-)\d+/</span>] <span class="ruby-comment"># CREATE</span>
      <span class="ruby-identifier">elt</span> = <span class="ruby-constant">Access</span>.<span class="ruby-identifier">load_from_params</span>(<span class="ruby-identifier">v</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">elt</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:accesses</span>, <span class="ruby-identifier">_</span>(<span class="ruby-string">&quot;Invalid accesses: %{d}&quot;</span>) <span class="ruby-operator">%</span> {<span class="ruby-value">:d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">','</span>)})
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">elt</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span> <span class="ruby-comment"># UNCHANGED OR DESTROY</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;-1&quot;</span> <span class="ruby-comment">#DESTROY</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">accesses</span>.<span class="ruby-identifier">destroy</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">val</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">k</span>)
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">Access</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">elt</span> = <span class="ruby-constant">Access</span>.<span class="ruby-identifier">load_from_params</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">k</span>))
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">changed?</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:accesses</span>, <span class="ruby-identifier">_</span>(<span class="ruby-string">&quot;Invalid accesses: %{d}&quot;</span>) <span class="ruby-operator">%</span> {<span class="ruby-value">:d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">','</span>)})
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">elt</span>
    <span class="ruby-keyword">end</span>
  }.<span class="ruby-identifier">compact</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
  <span class="ruby-identifier">val</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:to_i</span>).<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">accesses</span> = (<span class="ruby-identifier">val</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> [] <span class="ruby-operator">:</span> <span class="ruby-constant">Access</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">val</span>))
<span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>, <span class="ruby-constant">Fixnum</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">accesses</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> [<span class="ruby-constant">Access</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">val</span>)]
<span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">else</span> <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Unexpected params type for 'accesses': #{val.class}&quot;</span>)
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- accesses_load_from_params-source -->
          
        </div>

        

        
      </div><!-- accesses_load_from_params-method -->

    
      <div id="method-i-can_run-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">can_run?</span><span
            class="method-args">(action)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Checks accesses.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Sylvain Abélard</p>
</dd><dt>Version
<dd>
<p>3</p>
</dd><dt>Last Update
<dd>
<p>2010-06-16 14:31:31 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="can_run-3F-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1136</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">can_run?</span>(<span class="ruby-identifier">action</span>)
<span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">active?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">can_run_by_profile?</span>(<span class="ruby-identifier">action</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">can_run_self?</span>(<span class="ruby-identifier">action</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- can_run-3F-source -->
          
        </div>

        

        
      </div><!-- can_run-3F-method -->

    
      <div id="method-i-can_run_by_profile-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">can_run_by_profile?</span><span
            class="method-args">(action)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Check per-profile access.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>5</p>
</dd><dt>Last Update
<dd>
<p>2013-10-31 16:42:00 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="can_run_by_profile-3F-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1114</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">can_run_by_profile?</span>(<span class="ruby-identifier">action</span>)
<span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">active?</span>
<span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
  <span class="ruby-identifier">prof</span> = <span class="ruby-constant">Profile</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Not Logged'</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">prof</span>.<span class="ruby-identifier">can_run?</span>(<span class="ruby-identifier">action</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">prof</span>
<span class="ruby-keyword">elsif</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
  <span class="ruby-identifier">cond</span> = [<span class="ruby-string">&quot;profile_id IN (?) AND accesses.action_sid = ? AND accesses.table_sid = ?&quot;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">profile_ids</span>, <span class="ruby-identifier">action</span>[<span class="ruby-value">:action_sid</span>], <span class="ruby-identifier">action</span>[<span class="ruby-value">:table_sid</span>]]
  <span class="ruby-keyword">return</span> <span class="ruby-constant">ProfileAccess</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">cond</span>).<span class="ruby-identifier">include</span>(<span class="ruby-value">:access</span>).<span class="ruby-identifier">first</span>
<span class="ruby-keyword">elsif</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Access</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-constant">ProfileAccess</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-value">:profile_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">profile_ids</span>, <span class="ruby-value">:access_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">id</span>)
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- can_run_by_profile-3F-source -->
          
        </div>

        

        
      </div><!-- can_run_by_profile-3F-method -->

    
      <div id="method-i-can_run_self-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">can_run_self?</span><span
            class="method-args">(action)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Checks per-action access.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Sylvain Abélard</p>
</dd><dt>Version
<dd>
<p>3</p>
</dd><dt>Last Update
<dd>
<p>2010-06-16 14:31:10 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="can_run_self-3F-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1092</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">can_run_self?</span>(<span class="ruby-identifier">action</span>)
<span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">active?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span>
<span class="ruby-keyword">case</span> <span class="ruby-identifier">action</span>
<span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Access</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-constant">UserAccess</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:access_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">id</span>)
<span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span> <span class="ruby-keyword">then</span>
  <span class="ruby-identifier">cond</span> = [<span class="ruby-string">&quot;accesses.action_sid = ? AND accesses.table_sid = ?&quot;</span>, <span class="ruby-identifier">action</span>[<span class="ruby-value">:action_sid</span>], <span class="ruby-identifier">action</span>[<span class="ruby-value">:table_sid</span>]]
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_accesses</span>.<span class="ruby-identifier">first</span>(<span class="ruby-value">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:access</span>, <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cond</span>)
<span class="ruby-keyword">else</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- can_run_self-3F-source -->
          
        </div>

        

        
      </div><!-- can_run_self-3F-method -->

    
      <div id="method-i-customers__potential_values" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">customers__potential_values</span><span
            class="method-args">(options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>3</p>
</dd><dt>Last Update
<dd>
<p>2012-03-19 01:57:30 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="customers__potential_values-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1352</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">customers__potential_values</span>(<span class="ruby-identifier">options</span> = {})
<span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:page</span>)
  <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">else</span>
  <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- customers__potential_values-source -->
          
        </div>

        

        
      </div><!-- customers__potential_values-method -->

    
      <div id="method-i-customers_human_display" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">customers_human_display</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>useful method</p>
          

          
          <div class="method-source-code" id="customers_human_display-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1274</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">customers_human_display</span>

<span class="ruby-keyword">return</span> <span class="ruby-identifier">customers</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:disp_name</span>).<span class="ruby-identifier">to_sentence</span>(<span class="ruby-value">:connector</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">_</span>(<span class="ruby-string">'and'</span>))

<span class="ruby-keyword">end</span></pre>
          </div><!-- customers_human_display-source -->
          
        </div>

        

        
      </div><!-- customers_human_display-method -->

    
      <div id="method-i-customers_load_from_params" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">customers_load_from_params</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Load association from different params formats.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>4</p>
</dd><dt>Last Update
<dd>
<p>2013-10-02 15:11:56 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="customers_load_from_params-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1369</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">customers_load_from_params</span>(<span class="ruby-identifier">val</span>)

<span class="ruby-keyword">self</span>.<span class="ruby-identifier">customers_was</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">customers</span>.<span class="ruby-identifier">all</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span>
<span class="ruby-keyword">case</span> <span class="ruby-identifier">val</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>, <span class="ruby-constant">HashWithIndifferentAccess</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">customers</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">k</span>[<span class="ruby-regexp">%r\A(_|-)\d+/</span>] <span class="ruby-comment"># CREATE</span>
      <span class="ruby-identifier">elt</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">load_from_params</span>(<span class="ruby-identifier">v</span>)
      <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">elt</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:customers</span>, <span class="ruby-identifier">_</span>(<span class="ruby-string">&quot;Invalid customers: %{d}&quot;</span>) <span class="ruby-operator">%</span> {<span class="ruby-value">:d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">','</span>)})
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">elt</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span> <span class="ruby-comment"># UNCHANGED OR DESTROY</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;-1&quot;</span> <span class="ruby-comment">#DESTROY</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">customers</span>.<span class="ruby-identifier">destroy</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">val</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">k</span>)
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">elt</span> = <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">load_from_params</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">k</span>))
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">changed?</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:customers</span>, <span class="ruby-identifier">_</span>(<span class="ruby-string">&quot;Invalid customers: %{d}&quot;</span>) <span class="ruby-operator">%</span> {<span class="ruby-value">:d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">','</span>)})
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">elt</span>
    <span class="ruby-keyword">end</span>
  }.<span class="ruby-identifier">compact</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
  <span class="ruby-identifier">val</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:to_i</span>).<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">customers</span> = (<span class="ruby-identifier">val</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> [] <span class="ruby-operator">:</span> <span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">val</span>))
<span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>, <span class="ruby-constant">Fixnum</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">customers</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> [<span class="ruby-constant">Customer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">val</span>)]
<span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">else</span> <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Unexpected params type for 'customers': #{val.class}&quot;</span>)
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- customers_load_from_params-source -->
          
        </div>

        

        
      </div><!-- customers_load_from_params-method -->

    
      <div id="method-i-dev_feedbacks__potential_values" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dev_feedbacks__potential_values</span><span
            class="method-args">(options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>3</p>
</dd><dt>Last Update
<dd>
<p>2012-03-19 01:57:30 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="dev_feedbacks__potential_values-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1618</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dev_feedbacks__potential_values</span>(<span class="ruby-identifier">options</span> = {})
<span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:page</span>)
  <span class="ruby-constant">DevFeedback</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">else</span>
  <span class="ruby-constant">DevFeedback</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- dev_feedbacks__potential_values-source -->
          
        </div>

        

        
      </div><!-- dev_feedbacks__potential_values-method -->

    
      <div id="method-i-dev_feedbacks_human_display" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dev_feedbacks_human_display</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>useful method</p>
          

          
          <div class="method-source-code" id="dev_feedbacks_human_display-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1314</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dev_feedbacks_human_display</span>

<span class="ruby-keyword">return</span> <span class="ruby-identifier">dev_feedbacks</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:disp_name</span>).<span class="ruby-identifier">to_sentence</span>(<span class="ruby-value">:connector</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">_</span>(<span class="ruby-string">'and'</span>))

<span class="ruby-keyword">end</span></pre>
          </div><!-- dev_feedbacks_human_display-source -->
          
        </div>

        

        
      </div><!-- dev_feedbacks_human_display-method -->

    
      <div id="method-i-dev_feedbacks_load_from_params" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dev_feedbacks_load_from_params</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Load association from different params formats.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>4</p>
</dd><dt>Last Update
<dd>
<p>2013-10-02 15:11:56 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="dev_feedbacks_load_from_params-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1635</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dev_feedbacks_load_from_params</span>(<span class="ruby-identifier">val</span>)

<span class="ruby-keyword">self</span>.<span class="ruby-identifier">dev_feedbacks_was</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">dev_feedbacks</span>.<span class="ruby-identifier">all</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span>
<span class="ruby-keyword">case</span> <span class="ruby-identifier">val</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>, <span class="ruby-constant">HashWithIndifferentAccess</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">dev_feedbacks</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">k</span>[<span class="ruby-regexp">%r\A(_|-)\d+/</span>] <span class="ruby-comment"># CREATE</span>
      <span class="ruby-identifier">elt</span> = <span class="ruby-constant">DevFeedback</span>.<span class="ruby-identifier">load_from_params</span>(<span class="ruby-identifier">v</span>)
      <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">elt</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:dev_feedbacks</span>, <span class="ruby-identifier">_</span>(<span class="ruby-string">&quot;Invalid dev_feedbacks: %{d}&quot;</span>) <span class="ruby-operator">%</span> {<span class="ruby-value">:d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">','</span>)})
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">elt</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span> <span class="ruby-comment"># UNCHANGED OR DESTROY</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;-1&quot;</span> <span class="ruby-comment">#DESTROY</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">dev_feedbacks</span>.<span class="ruby-identifier">destroy</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">val</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">k</span>)
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">DevFeedback</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">elt</span> = <span class="ruby-constant">DevFeedback</span>.<span class="ruby-identifier">load_from_params</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">k</span>))
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">changed?</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:dev_feedbacks</span>, <span class="ruby-identifier">_</span>(<span class="ruby-string">&quot;Invalid dev_feedbacks: %{d}&quot;</span>) <span class="ruby-operator">%</span> {<span class="ruby-value">:d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">','</span>)})
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">elt</span>
    <span class="ruby-keyword">end</span>
  }.<span class="ruby-identifier">compact</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
  <span class="ruby-identifier">val</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:to_i</span>).<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">dev_feedbacks</span> = (<span class="ruby-identifier">val</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> [] <span class="ruby-operator">:</span> <span class="ruby-constant">DevFeedback</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">val</span>))
<span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>, <span class="ruby-constant">Fixnum</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">dev_feedbacks</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> [<span class="ruby-constant">DevFeedback</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">val</span>)]
<span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">else</span> <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Unexpected params type for 'dev_feedbacks': #{val.class}&quot;</span>)
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- dev_feedbacks_load_from_params-source -->
          
        </div>

        

        
      </div><!-- dev_feedbacks_load_from_params-method -->

    
      <div id="method-i-disp_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">disp_name</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Displays object name in human-readable format.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Sylvain Abélard</p>
</dd><dt>Version
<dd>
<p>4</p>
</dd><dt>Last Update
<dd>
<p>2010-06-16 14:33:02 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="disp_name-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1189</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">disp_name</span>
<span class="ruby-node">&quot;#{self.first_name} #{self.last_name}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- disp_name-source -->
          
        </div>

        

        
      </div><!-- disp_name-method -->

    
      <div id="method-i-email_welcome_and_pass" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">email_welcome_and_pass</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Send an email to user</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>3</p>
</dd><dt>Last Update
<dd>
<p>2009-09-01 16:52:43 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="email_welcome_and_pass-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1202</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">email_welcome_and_pass</span>
<span class="ruby-identifier">old_gt</span> = <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">locale</span>
<span class="ruby-constant">I18n</span>.<span class="ruby-identifier">locale</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">language</span> <span class="ruby-keyword">unless</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">language</span>.<span class="ruby-identifier">blank?</span>
<span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">deliver_account_infos</span>(<span class="ruby-keyword">self</span>, <span class="ruby-ivar">@password</span>) <span class="ruby-comment"># Uniq time with decoded password</span>
<span class="ruby-constant">I18n</span>.<span class="ruby-identifier">locale</span> = <span class="ruby-identifier">old_gt</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- email_welcome_and_pass-source -->
          
        </div>

        

        
      </div><!-- email_welcome_and_pass-method -->

    
      <div id="method-i-file_imports__potential_values" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_imports__potential_values</span><span
            class="method-args">(options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>3</p>
</dd><dt>Last Update
<dd>
<p>2012-03-19 01:57:30 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="file_imports__potential_values-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1685</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_imports__potential_values</span>(<span class="ruby-identifier">options</span> = {})
<span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:page</span>)
  <span class="ruby-constant">FileImport</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">else</span>
  <span class="ruby-constant">FileImport</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- file_imports__potential_values-source -->
          
        </div>

        

        
      </div><!-- file_imports__potential_values-method -->

    
      <div id="method-i-file_imports_human_display" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_imports_human_display</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>useful method</p>
          

          
          <div class="method-source-code" id="file_imports_human_display-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1324</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_imports_human_display</span>

<span class="ruby-keyword">return</span> <span class="ruby-identifier">file_imports</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:disp_name</span>).<span class="ruby-identifier">to_sentence</span>(<span class="ruby-value">:connector</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">_</span>(<span class="ruby-string">'and'</span>))

<span class="ruby-keyword">end</span></pre>
          </div><!-- file_imports_human_display-source -->
          
        </div>

        

        
      </div><!-- file_imports_human_display-method -->

    
      <div id="method-i-file_imports_load_from_params" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_imports_load_from_params</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Load association from different params formats.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>4</p>
</dd><dt>Last Update
<dd>
<p>2013-10-02 15:11:56 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="file_imports_load_from_params-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1702</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_imports_load_from_params</span>(<span class="ruby-identifier">val</span>)

<span class="ruby-keyword">self</span>.<span class="ruby-identifier">file_imports_was</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">file_imports</span>.<span class="ruby-identifier">all</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span>
<span class="ruby-keyword">case</span> <span class="ruby-identifier">val</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>, <span class="ruby-constant">HashWithIndifferentAccess</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">file_imports</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">k</span>[<span class="ruby-regexp">%r\A(_|-)\d+/</span>] <span class="ruby-comment"># CREATE</span>
      <span class="ruby-identifier">elt</span> = <span class="ruby-constant">FileImport</span>.<span class="ruby-identifier">load_from_params</span>(<span class="ruby-identifier">v</span>)
      <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">elt</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:file_imports</span>, <span class="ruby-identifier">_</span>(<span class="ruby-string">&quot;Invalid file_imports: %{d}&quot;</span>) <span class="ruby-operator">%</span> {<span class="ruby-value">:d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">','</span>)})
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">elt</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span> <span class="ruby-comment"># UNCHANGED OR DESTROY</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;-1&quot;</span> <span class="ruby-comment">#DESTROY</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">file_imports</span>.<span class="ruby-identifier">destroy</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">val</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">k</span>)
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">FileImport</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">elt</span> = <span class="ruby-constant">FileImport</span>.<span class="ruby-identifier">load_from_params</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">k</span>))
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">changed?</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:file_imports</span>, <span class="ruby-identifier">_</span>(<span class="ruby-string">&quot;Invalid file_imports: %{d}&quot;</span>) <span class="ruby-operator">%</span> {<span class="ruby-value">:d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">','</span>)})
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">elt</span>
    <span class="ruby-keyword">end</span>
  }.<span class="ruby-identifier">compact</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
  <span class="ruby-identifier">val</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:to_i</span>).<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">file_imports</span> = (<span class="ruby-identifier">val</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> [] <span class="ruby-operator">:</span> <span class="ruby-constant">FileImport</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">val</span>))
<span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>, <span class="ruby-constant">Fixnum</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">file_imports</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> [<span class="ruby-constant">FileImport</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">val</span>)]
<span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">else</span> <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Unexpected params type for 'file_imports': #{val.class}&quot;</span>)
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- file_imports_load_from_params-source -->
          
        </div>

        

        
      </div><!-- file_imports_load_from_params-method -->

    
      <div id="method-i-has_profile-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">has_profile?</span><span
            class="method-args">(*profiles)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns true if the user belongs to this profile (can be a profile id, name
or object).</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>8</p>
</dd><dt>Last Update
<dd>
<p>2012-12-25 18:44:30 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="has_profile-3F-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1066</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">has_profile?</span>(*<span class="ruby-identifier">profiles</span>)
<span class="ruby-ivar">@has_profiles</span> <span class="ruby-operator">||=</span> {}
<span class="ruby-identifier">profile</span> = <span class="ruby-identifier">profiles</span>.<span class="ruby-identifier">shift</span>
<span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">profile</span> <span class="ruby-operator">==</span> <span class="ruby-string">'Not Logged'</span>
<span class="ruby-ivar">@has_profiles</span>[<span class="ruby-identifier">profile</span>] = <span class="ruby-keyword">case</span> <span class="ruby-identifier">profile</span>
<span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">false</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Fixnum</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">profile_ids</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">profile</span>)
<span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">profiles</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">profile</span>).<span class="ruby-identifier">select</span>(<span class="ruby-string">'id'</span>).<span class="ruby-identifier">first</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Profile</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">profiles</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">profile</span>).<span class="ruby-identifier">select</span>(<span class="ruby-string">'id'</span>).<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@has_profiles</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">profile</span>)
<span class="ruby-keyword">return</span> <span class="ruby-ivar">@has_profiles</span>[<span class="ruby-identifier">profile</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">profiles</span>.<span class="ruby-identifier">find</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">has_profile?</span>(<span class="ruby-identifier">t</span>) }
<span class="ruby-keyword">end</span></pre>
          </div><!-- has_profile-3F-source -->
          
        </div>

        

        
      </div><!-- has_profile-3F-method -->

    
      <div id="method-i-home_page" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">home_page</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns a hash describing this user’s homepage URL.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>6</p>
</dd><dt>Last Update
<dd>
<p>2010-09-13 12:23:13 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="home_page-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1218</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">home_page</span>
<span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">has_profile?</span>(<span class="ruby-string">'Admin'</span>, <span class="ruby-string">'Faveod User'</span>)
  {<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:system_settings</span>}
<span class="ruby-keyword">else</span>
  {<span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:users</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:show</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>}
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- home_page-source -->
          
        </div>

        

        
      </div><!-- home_page-method -->

    
      <div id="method-i-is_admin-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_admin?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Shortcut: checks if user is administrator.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Sylvain Abélard</p>
</dd><dt>Version
<dd>
<p>3</p>
</dd><dt>Last Update
<dd>
<p>2010-06-16 14:32:42 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="is_admin-3F-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1176</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_admin?</span>
<span class="ruby-keyword">self</span>.<span class="ruby-identifier">has_profile?</span>(<span class="ruby-string">'Admin'</span>, <span class="ruby-string">'Faveod User'</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_admin-3F-source -->
          
        </div>

        

        
      </div><!-- is_admin-3F-method -->

    
      <div id="method-i-language__potential_values" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">language__potential_values</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Available languages.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Sylvain Abélard</p>
</dd><dt>Version
<dd>
<p>4</p>
</dd><dt>Last Update
<dd>
<p>2010-06-16 14:33:38 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="language__potential_values-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1235</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">language__potential_values</span>
(<span class="ruby-constant">GSS</span>[<span class="ruby-value">:locales</span>] <span class="ruby-operator">||</span> <span class="ruby-string">'en fr de ar'</span>).<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot; &quot;</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">l</span>,<span class="ruby-identifier">l</span>]}
<span class="ruby-keyword">end</span></pre>
          </div><!-- language__potential_values-source -->
          
        </div>

        

        
      </div><!-- language__potential_values-method -->

    
      <div id="method-i-next" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">next</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns next element.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>1</p>
</dd><dt>Last Update
<dd>
<p>2010-04-02 13:10:22 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="next-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 925</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">next</span>

  <span class="ruby-constant">User</span>.<span class="ruby-identifier">first</span>(<span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'users.id'</span>, <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;users.id &gt; ?&quot;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- next-source -->
          
        </div>

        

        
      </div><!-- next-method -->

    
      <div id="method-i-password-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">password=</span><span
            class="method-args">(pass)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Change password using random or parameter.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Sylvain Abélard</p>
</dd><dt>Version
<dd>
<p>5</p>
</dd><dt>Last Update
<dd>
<p>2012-05-23 10:47:58 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="password-3D-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1248</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">password=</span>(<span class="ruby-identifier">pass</span>)

<span class="ruby-identifier">chars</span> = (<span class="ruby-string">&quot;a&quot;</span><span class="ruby-operator">..</span><span class="ruby-string">&quot;z&quot;</span>).<span class="ruby-identifier">to_a</span> <span class="ruby-operator">+</span> (<span class="ruby-string">&quot;A&quot;</span><span class="ruby-operator">..</span><span class="ruby-string">&quot;Z&quot;</span>).<span class="ruby-identifier">to_a</span> <span class="ruby-operator">+</span> (<span class="ruby-string">&quot;0&quot;</span><span class="ruby-operator">..</span><span class="ruby-string">&quot;9&quot;</span>).<span class="ruby-identifier">to_a</span>
<span class="ruby-keyword">self</span>.<span class="ruby-identifier">salt</span> = (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">10</span>).<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-identifier">chars</span>[<span class="ruby-identifier">rand</span>(<span class="ruby-identifier">chars</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>)] }.<span class="ruby-identifier">join</span>
<span class="ruby-ivar">@password</span> = (<span class="ruby-identifier">pass</span> <span class="ruby-operator">==</span> <span class="ruby-value">:random</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">pass</span>.<span class="ruby-identifier">blank?</span>) <span class="ruby-operator">?</span> (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">10</span>).<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-identifier">chars</span>[<span class="ruby-identifier">rand</span>(<span class="ruby-identifier">chars</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>)] }.<span class="ruby-identifier">join</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">pass</span>
<span class="ruby-keyword">self</span>.<span class="ruby-identifier">hashed_password</span> = <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA1</span>.<span class="ruby-identifier">hexdigest</span>(<span class="ruby-ivar">@password</span><span class="ruby-operator">+</span><span class="ruby-keyword">self</span>.<span class="ruby-identifier">salt</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- password-3D-source -->
          
        </div>

        

        
      </div><!-- password-3D-method -->

    
      <div id="method-i-previous" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">previous</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Return the previous element.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>1</p>
</dd><dt>Last Update
<dd>
<p>2009-09-14 14:48:02 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="previous-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 911</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">previous</span>

  <span class="ruby-constant">User</span>.<span class="ruby-identifier">first</span>(<span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'users.id DESC'</span>, <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;users.id &lt; ?&quot;</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- previous-source -->
          
        </div>

        

        
      </div><!-- previous-method -->

    
      <div id="method-i-profiles__potential_values" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">profiles__potential_values</span><span
            class="method-args">(options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>3</p>
</dd><dt>Last Update
<dd>
<p>2012-03-19 01:57:30 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="profiles__potential_values-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1552</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">profiles__potential_values</span>(<span class="ruby-identifier">options</span> = {})
<span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:page</span>)
  <span class="ruby-constant">Profile</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">else</span>
  <span class="ruby-constant">Profile</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- profiles__potential_values-source -->
          
        </div>

        

        
      </div><!-- profiles__potential_values-method -->

    
      <div id="method-i-profiles_human_display" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">profiles_human_display</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>useful method</p>
          

          
          <div class="method-source-code" id="profiles_human_display-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1304</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">profiles_human_display</span>

<span class="ruby-keyword">return</span> <span class="ruby-identifier">profiles</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:disp_name</span>).<span class="ruby-identifier">to_sentence</span>(<span class="ruby-value">:connector</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">_</span>(<span class="ruby-string">'and'</span>))

<span class="ruby-keyword">end</span></pre>
          </div><!-- profiles_human_display-source -->
          
        </div>

        

        
      </div><!-- profiles_human_display-method -->

    
      <div id="method-i-profiles_load_from_params" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">profiles_load_from_params</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Load association from different params formats.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>4</p>
</dd><dt>Last Update
<dd>
<p>2013-10-02 15:11:56 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="profiles_load_from_params-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1569</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">profiles_load_from_params</span>(<span class="ruby-identifier">val</span>)

<span class="ruby-keyword">self</span>.<span class="ruby-identifier">profiles_was</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">profiles</span>.<span class="ruby-identifier">all</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span>
<span class="ruby-keyword">case</span> <span class="ruby-identifier">val</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>, <span class="ruby-constant">HashWithIndifferentAccess</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">profiles</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">k</span>[<span class="ruby-regexp">%r\A(_|-)\d+/</span>] <span class="ruby-comment"># CREATE</span>
      <span class="ruby-identifier">elt</span> = <span class="ruby-constant">Profile</span>.<span class="ruby-identifier">load_from_params</span>(<span class="ruby-identifier">v</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">elt</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:profiles</span>, <span class="ruby-identifier">_</span>(<span class="ruby-string">&quot;Invalid profiles: %{d}&quot;</span>) <span class="ruby-operator">%</span> {<span class="ruby-value">:d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">','</span>)})
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">elt</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span> <span class="ruby-comment"># UNCHANGED OR DESTROY</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;-1&quot;</span> <span class="ruby-comment">#DESTROY</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">profiles</span>.<span class="ruby-identifier">destroy</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">val</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">k</span>)
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">Profile</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">elt</span> = <span class="ruby-constant">Profile</span>.<span class="ruby-identifier">load_from_params</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">k</span>))
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">changed?</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:profiles</span>, <span class="ruby-identifier">_</span>(<span class="ruby-string">&quot;Invalid profiles: %{d}&quot;</span>) <span class="ruby-operator">%</span> {<span class="ruby-value">:d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">','</span>)})
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">elt</span>
    <span class="ruby-keyword">end</span>
  }.<span class="ruby-identifier">compact</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
  <span class="ruby-identifier">val</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:to_i</span>).<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">profiles</span> = (<span class="ruby-identifier">val</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> [] <span class="ruby-operator">:</span> <span class="ruby-constant">Profile</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">val</span>))
<span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>, <span class="ruby-constant">Fixnum</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">profiles</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> [<span class="ruby-constant">Profile</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">val</span>)]
<span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">else</span> <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Unexpected params type for 'profiles': #{val.class}&quot;</span>)
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- profiles_load_from_params-source -->
          
        </div>

        

        
      </div><!-- profiles_load_from_params-method -->

    
      <div id="method-i-set_default_password" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_default_password</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Sets a default randomized “salt” and password.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>7</p>
</dd><dt>Last Update
<dd>
<p>2011-03-29 18:44:29 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="set_default_password-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1163</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_default_password</span>
<span class="ruby-keyword">self</span>.<span class="ruby-identifier">password</span> = <span class="ruby-value">:random</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_default_password-source -->
          
        </div>

        

        
      </div><!-- set_default_password-method -->

    
      <div id="method-i-set_default_profiles" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_default_profiles</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Adds “Logged In” to a user’s profiles if not already present.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Sylvain Abélard</p>
</dd><dt>Version
<dd>
<p>4</p>
</dd><dt>Last Update
<dd>
<p>2010-06-16 14:32:00 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="set_default_profiles-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1149</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_default_profiles</span>
<span class="ruby-identifier">p</span> = <span class="ruby-constant">Profile</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-string">&quot;Logged In&quot;</span>)
<span class="ruby-identifier">profiles</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">profiles</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">p</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_default_profiles-source -->
          
        </div>

        

        
      </div><!-- set_default_profiles-method -->

    
      <div id="method-i-user_accesses__potential_values" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">user_accesses__potential_values</span><span
            class="method-args">(options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>3</p>
</dd><dt>Last Update
<dd>
<p>2012-03-19 01:57:30 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="user_accesses__potential_values-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1419</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">user_accesses__potential_values</span>(<span class="ruby-identifier">options</span> = {})
<span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:page</span>)
  <span class="ruby-constant">UserAccess</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">else</span>
  <span class="ruby-constant">UserAccess</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- user_accesses__potential_values-source -->
          
        </div>

        

        
      </div><!-- user_accesses__potential_values-method -->

    
      <div id="method-i-user_accesses_human_display" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">user_accesses_human_display</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>useful method</p>
          

          
          <div class="method-source-code" id="user_accesses_human_display-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1284</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">user_accesses_human_display</span>

<span class="ruby-keyword">return</span> <span class="ruby-identifier">user_accesses</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:disp_name</span>).<span class="ruby-identifier">to_sentence</span>(<span class="ruby-value">:connector</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">_</span>(<span class="ruby-string">'and'</span>))

<span class="ruby-keyword">end</span></pre>
          </div><!-- user_accesses_human_display-source -->
          
        </div>

        

        
      </div><!-- user_accesses_human_display-method -->

    
      <div id="method-i-user_accesses_load_from_params" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">user_accesses_load_from_params</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Load association from different params formats.</p>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Yann Azoury</p>
</dd><dt>Version
<dd>
<p>4</p>
</dd><dt>Last Update
<dd>
<p>2013-10-02 15:11:56 UTC</p>
</dd><dt>Status
<dd>
<p>Validated</p>
</dd></dl>
          

          
          <div class="method-source-code" id="user_accesses_load_from_params-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1436</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">user_accesses_load_from_params</span>(<span class="ruby-identifier">val</span>)

<span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_accesses_was</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_accesses</span>.<span class="ruby-identifier">all</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span>
<span class="ruby-keyword">case</span> <span class="ruby-identifier">val</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>, <span class="ruby-constant">HashWithIndifferentAccess</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_accesses</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">k</span>[<span class="ruby-regexp">%r\A(_|-)\d+/</span>] <span class="ruby-comment"># CREATE</span>
      <span class="ruby-identifier">elt</span> = <span class="ruby-constant">UserAccess</span>.<span class="ruby-identifier">load_from_params</span>(<span class="ruby-identifier">v</span>)
      <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">elt</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:user_accesses</span>, <span class="ruby-identifier">_</span>(<span class="ruby-string">&quot;Invalid user_accesses: %{d}&quot;</span>) <span class="ruby-operator">%</span> {<span class="ruby-value">:d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">','</span>)})
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">elt</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span> <span class="ruby-comment"># UNCHANGED OR DESTROY</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;-1&quot;</span> <span class="ruby-comment">#DESTROY</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_accesses</span>.<span class="ruby-identifier">destroy</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">val</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">k</span>)
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">UserAccess</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">k</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">elt</span> = <span class="ruby-constant">UserAccess</span>.<span class="ruby-identifier">load_from_params</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">k</span>))
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">valid?</span>
        <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">changed?</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:user_accesses</span>, <span class="ruby-identifier">_</span>(<span class="ruby-string">&quot;Invalid user_accesses: %{d}&quot;</span>) <span class="ruby-operator">%</span> {<span class="ruby-value">:d</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">elt</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">','</span>)})
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">elt</span>
    <span class="ruby-keyword">end</span>
  }.<span class="ruby-identifier">compact</span>
<span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
  <span class="ruby-identifier">val</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:to_i</span>).<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>}
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_accesses</span> = (<span class="ruby-identifier">val</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> [] <span class="ruby-operator">:</span> <span class="ruby-constant">UserAccess</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">val</span>))
<span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>, <span class="ruby-constant">Fixnum</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">user_accesses</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> [<span class="ruby-constant">UserAccess</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">val</span>)]
<span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">else</span> <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Unexpected params type for 'user_accesses': #{val.class}&quot;</span>)
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- user_accesses_load_from_params-source -->
          
        </div>

        

        
      </div><!-- user_accesses_load_from_params-method -->

    
      <div id="method-i-users_ids" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">users_ids</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Sylvain Abélard</p>
</dd><dt>Version
<dd>
<p>1</p>
</dd><dt>Last Update
<dd>
<p>2013-08-06 10:53:07 UTC</p>
</dd><dt>Status
<dd>
<p>In Progress</p>
</dd></dl>
          

          
          <div class="method-source-code" id="users_ids-source">
            <pre><span class="ruby-comment"># File app/models/user.rb, line 1263</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">users_ids</span>
<span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">has_profile?</span>(<span class="ruby-string">'Manager'</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sales</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">guy</span><span class="ruby-operator">|</span> <span class="ruby-identifier">guy</span>.<span class="ruby-identifier">users_ids</span>}
<span class="ruby-keyword">else</span>
  [<span class="ruby-keyword">self</span>.<span class="ruby-identifier">id</span>]
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- users_ids-source -->
          
        </div>

        

        
      </div><!-- users_ids-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.1.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

